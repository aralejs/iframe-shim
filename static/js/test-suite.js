(function(){function require(p){var path=require.resolve(p),mod=require.modules[path];if(!mod)throw new Error('failed to require "'+p+'"');if(!mod.exports){mod.exports={};mod.call(mod.exports,mod,mod.exports,require.relative(path))}return mod.exports}require.modules={};require.resolve=function(path){var orig=path,reg=path+".js",index=path+"/index.js";return require.modules[reg]&&reg||require.modules[index]&&index||orig};require.register=function(path,fn){require.modules[path]=fn};require.relative=function(parent){return function(p){if("."!=p.charAt(0))return require(p);var path=parent.split("/"),segs=p.split("/");path.pop();for(var i=0;i<segs.length;i++){var seg=segs[i];if(".."==seg)path.pop();else if("."!=seg)path.push(seg)}return require(path.join("/"))}};require.register("browser/debug.js",function(module,exports,require){module.exports=function(type){return function(){}}});require.register("browser/diff.js",function(module,exports,require){});require.register("browser/events.js",function(module,exports,require){exports.EventEmitter=EventEmitter;function isArray(obj){return"[object Array]"=={}.toString.call(obj)}function EventEmitter(){}EventEmitter.prototype.on=function(name,fn){if(!this.$events){this.$events={}}if(!this.$events[name]){this.$events[name]=fn}else if(isArray(this.$events[name])){this.$events[name].push(fn)}else{this.$events[name]=[this.$events[name],fn]}return this};EventEmitter.prototype.addListener=EventEmitter.prototype.on;EventEmitter.prototype.once=function(name,fn){var self=this;function on(){self.removeListener(name,on);fn.apply(this,arguments)}on.listener=fn;this.on(name,on);return this};EventEmitter.prototype.removeListener=function(name,fn){if(this.$events&&this.$events[name]){var list=this.$events[name];if(isArray(list)){var pos=-1;for(var i=0,l=list.length;i<l;i++){if(list[i]===fn||list[i].listener&&list[i].listener===fn){pos=i;break}}if(pos<0){return this}list.splice(pos,1);if(!list.length){delete this.$events[name]}}else if(list===fn||list.listener&&list.listener===fn){delete this.$events[name]}}return this};EventEmitter.prototype.removeAllListeners=function(name){if(name===undefined){this.$events={};return this}if(this.$events&&this.$events[name]){this.$events[name]=null}return this};EventEmitter.prototype.listeners=function(name){if(!this.$events){this.$events={}}if(!this.$events[name]){this.$events[name]=[]}if(!isArray(this.$events[name])){this.$events[name]=[this.$events[name]]}return this.$events[name]};EventEmitter.prototype.emit=function(name){if(!this.$events){return false}var handler=this.$events[name];if(!handler){return false}var args=[].slice.call(arguments,1);if("function"==typeof handler){handler.apply(this,args)}else if(isArray(handler)){var listeners=handler.slice();for(var i=0,l=listeners.length;i<l;i++){listeners[i].apply(this,args)}}else{return false}return true}});require.register("browser/fs.js",function(module,exports,require){});require.register("browser/path.js",function(module,exports,require){});require.register("browser/progress.js",function(module,exports,require){module.exports=Progress;function Progress(){this.percent=0;this.size(0);this.fontSize(11);this.font("helvetica, arial, sans-serif")}Progress.prototype.size=function(n){this._size=n;return this};Progress.prototype.text=function(str){this._text=str;return this};Progress.prototype.fontSize=function(n){this._fontSize=n;return this};Progress.prototype.font=function(family){this._font=family;return this};Progress.prototype.update=function(n){this.percent=n;return this};Progress.prototype.draw=function(ctx){var percent=Math.min(this.percent,100),size=this._size,half=size/2,x=half,y=half,rad=half-1,fontSize=this._fontSize;ctx.font=fontSize+"px "+this._font;var angle=Math.PI*2*(percent/100);ctx.clearRect(0,0,size,size);ctx.strokeStyle="#9f9f9f";ctx.beginPath();ctx.arc(x,y,rad,0,angle,false);ctx.stroke();ctx.strokeStyle="#eee";ctx.beginPath();ctx.arc(x,y,rad-1,0,angle,true);ctx.stroke();var text=this._text||(percent|0)+"%",w=ctx.measureText(text).width;ctx.fillText(text,x-w/2+1,y+fontSize/2-1);return this}});require.register("browser/tty.js",function(module,exports,require){exports.isatty=function(){return true};exports.getWindowSize=function(){return[window.innerHeight,window.innerWidth]}});require.register("context.js",function(module,exports,require){module.exports=Context;function Context(){}Context.prototype.runnable=function(runnable){if(0==arguments.length)return this._runnable;this.test=this._runnable=runnable;return this};Context.prototype.timeout=function(ms){this.runnable().timeout(ms);return this};Context.prototype.slow=function(ms){this.runnable().slow(ms);return this};Context.prototype.inspect=function(){return JSON.stringify(this,function(key,val){if("_runnable"==key)return;if("test"==key)return;return val},2)}});require.register("hook.js",function(module,exports,require){var Runnable=require("./runnable");module.exports=Hook;function Hook(title,fn){Runnable.call(this,title,fn);this.type="hook"}Hook.prototype=new Runnable;Hook.prototype.constructor=Hook;Hook.prototype.error=function(err){if(0==arguments.length){var err=this._error;this._error=null;return err}this._error=err}});require.register("interfaces/bdd.js",function(module,exports,require){var Suite=require("../suite"),Test=require("../test");module.exports=function(suite){var suites=[suite];suite.on("pre-require",function(context,file,mocha){context.before=function(fn){suites[0].beforeAll(fn)};context.after=function(fn){suites[0].afterAll(fn)};context.beforeEach=function(fn){suites[0].beforeEach(fn)};context.afterEach=function(fn){suites[0].afterEach(fn)};context.describe=context.context=function(title,fn){var suite=Suite.create(suites[0],title);suites.unshift(suite);fn.call(suite);suites.shift();return suite};context.xdescribe=context.xcontext=context.describe.skip=function(title,fn){var suite=Suite.create(suites[0],title);suite.pending=true;suites.unshift(suite);fn.call(suite);suites.shift()};context.describe.only=function(title,fn){var suite=context.describe(title,fn);mocha.grep(suite.fullTitle())};context.it=context.specify=function(title,fn){var suite=suites[0];if(suite.pending)var fn=null;var test=new Test(title,fn);suite.addTest(test);return test};context.it.only=function(title,fn){var test=context.it(title,fn);mocha.grep(test.fullTitle())};context.xit=context.xspecify=context.it.skip=function(title){context.it(title)}})}});require.register("interfaces/exports.js",function(module,exports,require){var Suite=require("../suite"),Test=require("../test");module.exports=function(suite){var suites=[suite];suite.on("require",visit);function visit(obj){var suite;for(var key in obj){if("function"==typeof obj[key]){var fn=obj[key];switch(key){case"before":suites[0].beforeAll(fn);break;case"after":suites[0].afterAll(fn);break;case"beforeEach":suites[0].beforeEach(fn);break;case"afterEach":suites[0].afterEach(fn);break;default:suites[0].addTest(new Test(key,fn))}}else{var suite=Suite.create(suites[0],key);suites.unshift(suite);visit(obj[key]);suites.shift()}}}}});require.register("interfaces/index.js",function(module,exports,require){exports.bdd=require("./bdd");exports.tdd=require("./tdd");exports.qunit=require("./qunit");exports.exports=require("./exports")});require.register("interfaces/qunit.js",function(module,exports,require){var Suite=require("../suite"),Test=require("../test");module.exports=function(suite){var suites=[suite];suite.on("pre-require",function(context){context.before=function(fn){suites[0].beforeAll(fn)};context.after=function(fn){suites[0].afterAll(fn)};context.beforeEach=function(fn){suites[0].beforeEach(fn)};context.afterEach=function(fn){suites[0].afterEach(fn)};context.suite=function(title){if(suites.length>1)suites.shift();var suite=Suite.create(suites[0],title);suites.unshift(suite)};context.test=function(title,fn){suites[0].addTest(new Test(title,fn))}})}});require.register("interfaces/tdd.js",function(module,exports,require){var Suite=require("../suite"),Test=require("../test");module.exports=function(suite){var suites=[suite];suite.on("pre-require",function(context,file,mocha){context.setup=function(fn){suites[0].beforeEach(fn)};context.teardown=function(fn){suites[0].afterEach(fn)};context.suiteSetup=function(fn){suites[0].beforeAll(fn)};context.suiteTeardown=function(fn){suites[0].afterAll(fn)};context.suite=function(title,fn){var suite=Suite.create(suites[0],title);suites.unshift(suite);fn.call(suite);suites.shift();return suite};context.suite.only=function(title,fn){var suite=context.suite(title,fn);mocha.grep(suite.fullTitle())};context.test=function(title,fn){var test=new Test(title,fn);suites[0].addTest(test);return test};context.test.only=function(title,fn){var test=context.test(title,fn);mocha.grep(test.fullTitle())};context.test.skip=function(title){context.test(title)}})}});require.register("mocha.js",function(module,exports,require){var path=require("browser/path"),utils=require("./utils");exports=module.exports=Mocha;exports.utils=utils;exports.interfaces=require("./interfaces");exports.reporters=require("./reporters");exports.Runnable=require("./runnable");exports.Context=require("./context");exports.Runner=require("./runner");exports.Suite=require("./suite");exports.Hook=require("./hook");exports.Test=require("./test");function image(name){return __dirname+"/../images/"+name+".png"}function Mocha(options){options=options||{};this.files=[];this.options=options;this.grep(options.grep);this.suite=new exports.Suite("",new exports.Context);this.ui(options.ui);this.reporter(options.reporter);if(options.timeout)this.timeout(options.timeout);if(options.slow)this.slow(options.slow)}Mocha.prototype.addFile=function(file){this.files.push(file);return this};Mocha.prototype.reporter=function(reporter){if("function"==typeof reporter){this._reporter=reporter}else{reporter=reporter||"dot";try{this._reporter=require("./reporters/"+reporter)}catch(err){this._reporter=require(reporter)}if(!this._reporter)throw new Error('invalid reporter "'+reporter+'"')}return this};Mocha.prototype.ui=function(name){name=name||"bdd";this._ui=exports.interfaces[name];if(!this._ui)throw new Error('invalid interface "'+name+'"');this._ui=this._ui(this.suite);return this};Mocha.prototype.loadFiles=function(fn){var self=this;var suite=this.suite;var pending=this.files.length;this.files.forEach(function(file){file=path.resolve(file);suite.emit("pre-require",global,file,self);suite.emit("require",require(file),file,self);suite.emit("post-require",global,file,self);--pending||fn&&fn()})};Mocha.prototype._growl=function(runner,reporter){var notify=require("growl");runner.on("end",function(){var stats=reporter.stats;if(stats.failures){var msg=stats.failures+" of "+runner.total+" tests failed";notify(msg,{name:"mocha",title:"Failed",image:image("error")})}else{notify(stats.passes+" tests passed in "+stats.duration+"ms",{name:"mocha",title:"Passed",image:image("ok")})}})};Mocha.prototype.grep=function(re){this.options.grep="string"==typeof re?new RegExp(utils.escapeRegexp(re)):re;return this};Mocha.prototype.invert=function(){this.options.invert=true;return this};Mocha.prototype.ignoreLeaks=function(){this.options.ignoreLeaks=true;return this};Mocha.prototype.checkLeaks=function(){this.options.ignoreLeaks=false;return this};Mocha.prototype.growl=function(){this.options.growl=true;return this};Mocha.prototype.globals=function(globals){this.options.globals=(this.options.globals||[]).concat(globals);return this};Mocha.prototype.timeout=function(timeout){this.suite.timeout(timeout);return this};Mocha.prototype.slow=function(slow){this.suite.slow(slow);return this};Mocha.prototype.asyncOnly=function(){this.options.asyncOnly=true;return this};Mocha.prototype.run=function(fn){if(this.files.length)this.loadFiles();var suite=this.suite;var options=this.options;var runner=new exports.Runner(suite);var reporter=new this._reporter(runner);runner.ignoreLeaks=options.ignoreLeaks;runner.asyncOnly=options.asyncOnly;if(options.grep)runner.grep(options.grep,options.invert);if(options.globals)runner.globals(options.globals);if(options.growl)this._growl(runner,reporter);return runner.run(fn)}});require.register("ms.js",function(module,exports,require){var s=1e3;var m=s*60;var h=m*60;var d=h*24;module.exports=function(val){if("string"==typeof val)return parse(val);return format(val)};function parse(str){var m=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(str);if(!m)return;var n=parseFloat(m[1]);var type=(m[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"y":return n*315576e5;case"days":case"day":case"d":return n*864e5;case"hours":case"hour":case"h":return n*36e5;case"minutes":case"minute":case"m":return n*6e4;case"seconds":case"second":case"s":return n*1e3;case"ms":return n}}function format(ms){if(ms==d)return Math.round(ms/d)+" day";if(ms>d)return Math.round(ms/d)+" days";if(ms==h)return Math.round(ms/h)+" hour";if(ms>h)return Math.round(ms/h)+" hours";if(ms==m)return Math.round(ms/m)+" minute";if(ms>m)return Math.round(ms/m)+" minutes";if(ms==s)return Math.round(ms/s)+" second";if(ms>s)return Math.round(ms/s)+" seconds";return ms+" ms"}});require.register("reporters/base.js",function(module,exports,require){var tty=require("browser/tty"),diff=require("browser/diff"),ms=require("../ms");var Date=global.Date,setTimeout=global.setTimeout,setInterval=global.setInterval,clearTimeout=global.clearTimeout,clearInterval=global.clearInterval;var isatty=tty.isatty(1)&&tty.isatty(2);exports=module.exports=Base;exports.useColors=isatty;exports.colors={pass:90,fail:31,"bright pass":92,"bright fail":91,"bright yellow":93,pending:36,suite:0,"error title":0,"error message":31,"error stack":90,checkmark:32,fast:90,medium:33,slow:31,green:32,light:90,"diff gutter":90,"diff added":42,"diff removed":41};exports.symbols={ok:"✓",err:"✖",dot:"․"};if("win32"==process.platform){exports.symbols.ok="√";exports.symbols.err="×";exports.symbols.dot="."}var color=exports.color=function(type,str){if(!exports.useColors)return str;return"["+exports.colors[type]+"m"+str+"[0m"};exports.window={width:isatty?process.stdout.getWindowSize?process.stdout.getWindowSize(1)[0]:tty.getWindowSize()[1]:75};exports.cursor={hide:function(){process.stdout.write("[?25l")},show:function(){process.stdout.write("[?25h")},deleteLine:function(){process.stdout.write("[2K")},beginningOfLine:function(){process.stdout.write("[0G")},CR:function(){exports.cursor.deleteLine();exports.cursor.beginningOfLine()}};exports.list=function(failures){console.error();failures.forEach(function(test,i){var fmt=color("error title","  %s) %s:\n")+color("error message","     %s")+color("error stack","\n%s\n");var err=test.err,message=err.message||"",stack=err.stack||message,index=stack.indexOf(message)+message.length,msg=stack.slice(0,index),actual=err.actual,expected=err.expected,escape=true;if(err.showDiff){escape=false;err.actual=actual=JSON.stringify(actual,null,2);err.expected=expected=JSON.stringify(expected,null,2)}if("string"==typeof actual&&"string"==typeof expected){var len=Math.max(actual.length,expected.length);if(len<20)msg=errorDiff(err,"Chars",escape);else msg=errorDiff(err,"Words",escape);var lines=msg.split("\n");if(lines.length>4){var width=String(lines.length).length;msg=lines.map(function(str,i){return pad(++i,width)+" |"+" "+str}).join("\n")}msg="\n"+color("diff removed","actual")+" "+color("diff added","expected")+"\n\n"+msg+"\n";msg=msg.replace(/^/gm,"      ");fmt=color("error title","  %s) %s:\n%s")+color("error stack","\n%s\n")}stack=stack.slice(index?index+1:index).replace(/^/gm,"  ");console.error(fmt,i+1,test.fullTitle(),msg,stack)})};function Base(runner){var self=this,stats=this.stats={suites:0,tests:0,passes:0,pending:0,failures:0},failures=this.failures=[];if(!runner)return;this.runner=runner;runner.stats=stats;runner.on("start",function(){stats.start=new Date});runner.on("suite",function(suite){stats.suites=stats.suites||0;suite.root||stats.suites++});runner.on("test end",function(test){stats.tests=stats.tests||0;stats.tests++});runner.on("pass",function(test){stats.passes=stats.passes||0;var medium=test.slow()/2;test.speed=test.duration>test.slow()?"slow":test.duration>medium?"medium":"fast";stats.passes++});runner.on("fail",function(test,err){stats.failures=stats.failures||0;stats.failures++;test.err=err;failures.push(test)});runner.on("end",function(){stats.end=new Date;stats.duration=new Date-stats.start});runner.on("pending",function(){stats.pending++})}Base.prototype.epilogue=function(){var stats=this.stats,fmt,tests;console.log();function pluralize(n){return 1==n?"test":"tests"}if(stats.failures){fmt=color("bright fail","  "+exports.symbols.err)+color("fail"," %d of %d %s failed")+color("light",":");console.error(fmt,stats.failures,this.runner.total,pluralize(this.runner.total));Base.list(this.failures);console.error();return}fmt=color("bright pass"," ")+color("green"," %d %s complete")+color("light"," (%s)");console.log(fmt,stats.tests||0,pluralize(stats.tests),ms(stats.duration));if(stats.pending){fmt=color("pending"," ")+color("pending"," %d %s pending");console.log(fmt,stats.pending,pluralize(stats.pending))}console.log()};function pad(str,len){str=String(str);return Array(len-str.length+1).join(" ")+str}function errorDiff(err,type,escape){return diff["diff"+type](err.actual,err.expected).map(function(str){if(escape){str.value=str.value.replace(/\t/g,"<tab>").replace(/\r/g,"<CR>").replace(/\n/g,"<LF>\n")}if(str.added)return colorLines("diff added",str.value);if(str.removed)return colorLines("diff removed",str.value);return str.value}).join("")}function colorLines(name,str){return str.split("\n").map(function(str){return color(name,str)}).join("\n")}});require.register("reporters/doc.js",function(module,exports,require){var Base=require("./base"),utils=require("../utils");exports=module.exports=Doc;function Doc(runner){Base.call(this,runner);var self=this,stats=this.stats,total=runner.total,indents=2;function indent(){return Array(indents).join("  ")}runner.on("suite",function(suite){if(suite.root)return;++indents;console.log('%s<section class="suite">',indent());++indents;console.log("%s<h1>%s</h1>",indent(),utils.escape(suite.title));console.log("%s<dl>",indent())});runner.on("suite end",function(suite){if(suite.root)return;console.log("%s</dl>",indent());--indents;console.log("%s</section>",indent());--indents});runner.on("pass",function(test){console.log("%s  <dt>%s</dt>",indent(),utils.escape(test.title));var code=utils.escape(utils.clean(test.fn.toString()));console.log("%s  <dd><pre><code>%s</code></pre></dd>",indent(),code)})}});require.register("reporters/dot.js",function(module,exports,require){var Base=require("./base"),color=Base.color;exports=module.exports=Dot;function Dot(runner){Base.call(this,runner);var self=this,stats=this.stats,width=Base.window.width*.75|0,n=0;runner.on("start",function(){process.stdout.write("\n  ")});runner.on("pending",function(test){process.stdout.write(color("pending",Base.symbols.dot))});runner.on("pass",function(test){if(++n%width==0)process.stdout.write("\n  ");if("slow"==test.speed){process.stdout.write(color("bright yellow",Base.symbols.dot))}else{process.stdout.write(color(test.speed,Base.symbols.dot))}});runner.on("fail",function(test,err){if(++n%width==0)process.stdout.write("\n  ");process.stdout.write(color("fail",Base.symbols.dot))});runner.on("end",function(){console.log();self.epilogue()})}Dot.prototype=new Base;Dot.prototype.constructor=Dot});require.register("reporters/html-cov.js",function(module,exports,require){var JSONCov=require("./json-cov"),fs=require("browser/fs");exports=module.exports=HTMLCov;function HTMLCov(runner){var jade=require("jade"),file=__dirname+"/templates/coverage.jade",str=fs.readFileSync(file,"utf8"),fn=jade.compile(str,{filename:file}),self=this;JSONCov.call(this,runner,false);runner.on("end",function(){process.stdout.write(fn({cov:self.cov,coverageClass:coverageClass}))})}function coverageClass(n){if(n>=75)return"high";if(n>=50)return"medium";if(n>=25)return"low";return"terrible"}});require.register("reporters/html.js",function(module,exports,require){var Base=require("./base"),utils=require("../utils"),Progress=require("../browser/progress"),escape=utils.escape;var Date=global.Date,setTimeout=global.setTimeout,setInterval=global.setInterval,clearTimeout=global.clearTimeout,clearInterval=global.clearInterval;exports=module.exports=HTML;var statsTemplate='<ul id="mocha-stats">'+'<li class="progress"><canvas width="40" height="40"></canvas></li>'+'<li class="passes"><a href="#">passes:</a> <em>0</em></li>'+'<li class="failures"><a href="#">failures:</a> <em>0</em></li>'+'<li class="duration">duration: <em>0</em>s</li>'+"</ul>";function HTML(runner,root){Base.call(this,runner);var self=this,stats=this.stats,total=runner.total,stat=fragment(statsTemplate),items=stat.getElementsByTagName("li"),passes=items[1].getElementsByTagName("em")[0],passesLink=items[1].getElementsByTagName("a")[0],failures=items[2].getElementsByTagName("em")[0],failuresLink=items[2].getElementsByTagName("a")[0],duration=items[3].getElementsByTagName("em")[0],canvas=stat.getElementsByTagName("canvas")[0],report=fragment('<ul id="mocha-report"></ul>'),stack=[report],progress,ctx;root=root||document.getElementById("mocha");if(canvas.getContext){var ratio=window.devicePixelRatio||1;canvas.style.width=canvas.width;canvas.style.height=canvas.height;canvas.width*=ratio;canvas.height*=ratio;ctx=canvas.getContext("2d");ctx.scale(ratio,ratio);progress=new Progress}if(!root)return error("#mocha div missing, add it to your document");on(passesLink,"click",function(){unhide();var name=/pass/.test(report.className)?"":" pass";report.className=report.className.replace(/fail|pass/g,"")+name;if(report.className.trim())hideSuitesWithout("test pass")});on(failuresLink,"click",function(){unhide();var name=/fail/.test(report.className)?"":" fail";report.className=report.className.replace(/fail|pass/g,"")+name;if(report.className.trim())hideSuitesWithout("test fail")});root.appendChild(stat);root.appendChild(report);if(progress)progress.size(40);runner.on("suite",function(suite){if(suite.root)return;var url="?grep="+encodeURIComponent(suite.fullTitle());var el=fragment('<li class="suite"><h1><a href="%s">%s</a></h1></li>',url,escape(suite.title));stack[0].appendChild(el);stack.unshift(document.createElement("ul"));el.appendChild(stack[0])});runner.on("suite end",function(suite){if(suite.root)return;stack.shift()});runner.on("fail",function(test,err){if("hook"==test.type)runner.emit("test end",test)});runner.on("test end",function(test){var percent=stats.tests/this.total*100|0;if(progress)progress.update(percent).draw(ctx);var ms=new Date-stats.start;text(passes,stats.passes);text(failures,stats.failures);text(duration,(ms/1e3).toFixed(2));if("passed"==test.state){var el=fragment('<li class="test pass %e"><h2>%e<span class="duration">%ems</span> <a href="?grep=%e" class="replay">‣</a></h2></li>',test.speed,test.title,test.duration,encodeURIComponent(test.fullTitle()))}else if(test.pending){var el=fragment('<li class="test pass pending"><h2>%e</h2></li>',test.title)}else{var el=fragment('<li class="test fail"><h2>%e <a href="?grep=%e" class="replay">‣</a></h2></li>',test.title,encodeURIComponent(test.fullTitle()));var str=test.err.stack||test.err.toString();if(!~str.indexOf(test.err.message)){str=test.err.message+"\n"+str}if("[object Error]"==str)str=test.err.message;if(!test.err.stack&&test.err.sourceURL&&test.err.line!==undefined){str+="\n("+test.err.sourceURL+":"+test.err.line+")"}el.appendChild(fragment('<pre class="error">%e</pre>',str))}if(!test.pending){var h2=el.getElementsByTagName("h2")[0];on(h2,"click",function(){pre.style.display="none"==pre.style.display?"inline-block":"none"});var pre=fragment("<pre><code>%e</code></pre>",utils.clean(test.fn.toString()));el.appendChild(pre);pre.style.display="none"}if(stack[0])stack[0].appendChild(el)})}function error(msg){document.body.appendChild(fragment('<div id="mocha-error">%s</div>',msg))}function fragment(html){var args=arguments,div=document.createElement("div"),i=1;div.innerHTML=html.replace(/%([se])/g,function(_,type){switch(type){case"s":return String(args[i++]);case"e":return escape(args[i++])}});return div.firstChild}function hideSuitesWithout(classname){var suites=document.getElementsByClassName("suite");for(var i=0;i<suites.length;i++){var els=suites[i].getElementsByClassName(classname);if(0==els.length)suites[i].className+=" hidden"}}function unhide(){var els=document.getElementsByClassName("suite hidden");for(var i=0;i<els.length;++i){els[i].className=els[i].className.replace("suite hidden","suite")}}function text(el,str){if(el.textContent){el.textContent=str}else{el.innerText=str}}function on(el,event,fn){if(el.addEventListener){el.addEventListener(event,fn,false)}else{el.attachEvent("on"+event,fn)}}});require.register("reporters/index.js",function(module,exports,require){exports.Base=require("./base");exports.Dot=require("./dot");exports.Doc=require("./doc");exports.TAP=require("./tap");exports.JSON=require("./json");exports.HTML=require("./html");exports.List=require("./list");exports.Min=require("./min");exports.Spec=require("./spec");exports.Nyan=require("./nyan");exports.XUnit=require("./xunit");exports.Markdown=require("./markdown");exports.Progress=require("./progress");exports.Landing=require("./landing");exports.JSONCov=require("./json-cov");exports.HTMLCov=require("./html-cov");exports.JSONStream=require("./json-stream");exports.Teamcity=require("./teamcity")});require.register("reporters/json-cov.js",function(module,exports,require){var Base=require("./base");exports=module.exports=JSONCov;function JSONCov(runner,output){var self=this,output=1==arguments.length?true:output;Base.call(this,runner);var tests=[],failures=[],passes=[];runner.on("test end",function(test){tests.push(test)});runner.on("pass",function(test){passes.push(test)});runner.on("fail",function(test){failures.push(test)});runner.on("end",function(){var cov=global._$jscoverage||{};var result=self.cov=map(cov);result.stats=self.stats;result.tests=tests.map(clean);result.failures=failures.map(clean);result.passes=passes.map(clean);if(!output)return;process.stdout.write(JSON.stringify(result,null,2))})}function map(cov){var ret={instrumentation:"node-jscoverage",sloc:0,hits:0,misses:0,coverage:0,files:[]};for(var filename in cov){var data=coverage(filename,cov[filename]);ret.files.push(data);ret.hits+=data.hits;ret.misses+=data.misses;ret.sloc+=data.sloc}ret.files.sort(function(a,b){return a.filename.localeCompare(b.filename)});if(ret.sloc>0){ret.coverage=ret.hits/ret.sloc*100}return ret}function coverage(filename,data){var ret={filename:filename,coverage:0,hits:0,misses:0,sloc:0,source:{}};data.source.forEach(function(line,num){num++;if(data[num]===0){ret.misses++;ret.sloc++}else if(data[num]!==undefined){ret.hits++;ret.sloc++}ret.source[num]={source:line,coverage:data[num]===undefined?"":data[num]}});ret.coverage=ret.hits/ret.sloc*100;return ret}function clean(test){return{title:test.title,fullTitle:test.fullTitle(),duration:test.duration}}});require.register("reporters/json-stream.js",function(module,exports,require){var Base=require("./base"),color=Base.color;exports=module.exports=List;function List(runner){Base.call(this,runner);var self=this,stats=this.stats,total=runner.total;runner.on("start",function(){console.log(JSON.stringify(["start",{total:total}]))});runner.on("pass",function(test){console.log(JSON.stringify(["pass",clean(test)]))});runner.on("fail",function(test,err){console.log(JSON.stringify(["fail",clean(test)]))});runner.on("end",function(){process.stdout.write(JSON.stringify(["end",self.stats]))})}function clean(test){return{title:test.title,fullTitle:test.fullTitle(),duration:test.duration}}});require.register("reporters/json.js",function(module,exports,require){var Base=require("./base"),cursor=Base.cursor,color=Base.color;exports=module.exports=JSONReporter;function JSONReporter(runner){var self=this;Base.call(this,runner);var tests=[],failures=[],passes=[];runner.on("test end",function(test){tests.push(test)});runner.on("pass",function(test){passes.push(test)});runner.on("fail",function(test){failures.push(test)});runner.on("end",function(){var obj={stats:self.stats,tests:tests.map(clean),failures:failures.map(clean),passes:passes.map(clean)};process.stdout.write(JSON.stringify(obj,null,2))})}function clean(test){return{title:test.title,fullTitle:test.fullTitle(),duration:test.duration}}});require.register("reporters/landing.js",function(module,exports,require){var Base=require("./base"),cursor=Base.cursor,color=Base.color;exports=module.exports=Landing;Base.colors.plane=0;Base.colors["plane crash"]=31;Base.colors.runway=90;function Landing(runner){Base.call(this,runner);var self=this,stats=this.stats,width=Base.window.width*.75|0,total=runner.total,stream=process.stdout,plane=color("plane","✈"),crashed=-1,n=0;function runway(){var buf=Array(width).join("-");return"  "+color("runway",buf)}runner.on("start",function(){stream.write("\n  ");cursor.hide()});runner.on("test end",function(test){var col=-1==crashed?width*++n/total|0:crashed;if("failed"==test.state){plane=color("plane crash","✈");crashed=col}stream.write("[4F\n\n");stream.write(runway());stream.write("\n  ");stream.write(color("runway",Array(col).join("⋅")));stream.write(plane);stream.write(color("runway",Array(width-col).join("⋅")+"\n"));stream.write(runway());stream.write("[0m")});runner.on("end",function(){cursor.show();console.log();self.epilogue()})}Landing.prototype=new Base;Landing.prototype.constructor=Landing});require.register("reporters/list.js",function(module,exports,require){var Base=require("./base"),cursor=Base.cursor,color=Base.color;exports=module.exports=List;function List(runner){Base.call(this,runner);var self=this,stats=this.stats,n=0;runner.on("start",function(){console.log()});runner.on("test",function(test){process.stdout.write(color("pass","    "+test.fullTitle()+": "))});runner.on("pending",function(test){var fmt=color("checkmark","  -")+color("pending"," %s");console.log(fmt,test.fullTitle())});runner.on("pass",function(test){var fmt=color("checkmark","  "+Base.symbols.dot)+color("pass"," %s: ")+color(test.speed,"%dms");cursor.CR();console.log(fmt,test.fullTitle(),test.duration)});runner.on("fail",function(test,err){cursor.CR();console.log(color("fail","  %d) %s"),++n,test.fullTitle())});runner.on("end",self.epilogue.bind(self))}List.prototype=new Base;List.prototype.constructor=List});require.register("reporters/markdown.js",function(module,exports,require){var Base=require("./base"),utils=require("../utils");exports=module.exports=Markdown;function Markdown(runner){Base.call(this,runner);var self=this,stats=this.stats,total=runner.total,level=0,buf="";function title(str){return Array(level).join("#")+" "+str}function indent(){return Array(level).join("  ")}function mapTOC(suite,obj){var ret=obj;obj=obj[suite.title]=obj[suite.title]||{suite:suite};suite.suites.forEach(function(suite){mapTOC(suite,obj)});return ret}function stringifyTOC(obj,level){++level;var buf="";var link;for(var key in obj){if("suite"==key)continue;if(key)link=" - ["+key+"](#"+utils.slug(obj[key].suite.fullTitle())+")\n";if(key)buf+=Array(level).join("  ")+link;buf+=stringifyTOC(obj[key],level)}--level;return buf}function generateTOC(suite){var obj=mapTOC(suite,{});return stringifyTOC(obj,0)}generateTOC(runner.suite);runner.on("suite",function(suite){++level;var slug=utils.slug(suite.fullTitle());buf+='<a name="'+slug+'"></a>'+"\n";buf+=title(suite.title)+"\n"});runner.on("suite end",function(suite){--level});runner.on("pass",function(test){var code=utils.clean(test.fn.toString());buf+=test.title+".\n";buf+="\n```js\n";buf+=code+"\n";buf+="```\n\n"});runner.on("end",function(){process.stdout.write("# TOC\n");process.stdout.write(generateTOC(runner.suite));
process.stdout.write(buf)})}});require.register("reporters/min.js",function(module,exports,require){var Base=require("./base");exports=module.exports=Min;function Min(runner){Base.call(this,runner);runner.on("start",function(){process.stdout.write("[2J");process.stdout.write("[1;3H")});runner.on("end",this.epilogue.bind(this))}Min.prototype=new Base;Min.prototype.constructor=Min});require.register("reporters/nyan.js",function(module,exports,require){var Base=require("./base"),color=Base.color;exports=module.exports=NyanCat;function NyanCat(runner){Base.call(this,runner);var self=this,stats=this.stats,width=Base.window.width*.75|0,rainbowColors=this.rainbowColors=self.generateColors(),colorIndex=this.colorIndex=0,numerOfLines=this.numberOfLines=4,trajectories=this.trajectories=[[],[],[],[]],nyanCatWidth=this.nyanCatWidth=11,trajectoryWidthMax=this.trajectoryWidthMax=width-nyanCatWidth,scoreboardWidth=this.scoreboardWidth=5,tick=this.tick=0,n=0;runner.on("start",function(){Base.cursor.hide();self.draw("start")});runner.on("pending",function(test){self.draw("pending")});runner.on("pass",function(test){self.draw("pass")});runner.on("fail",function(test,err){self.draw("fail")});runner.on("end",function(){Base.cursor.show();for(var i=0;i<self.numberOfLines;i++)write("\n");self.epilogue()})}NyanCat.prototype.draw=function(status){this.appendRainbow();this.drawScoreboard();this.drawRainbow();this.drawNyanCat(status);this.tick=!this.tick};NyanCat.prototype.drawScoreboard=function(){var stats=this.stats;var colors=Base.colors;function draw(color,n){write(" ");write("["+color+"m"+n+"[0m");write("\n")}draw(colors.green,stats.passes);draw(colors.fail,stats.failures);draw(colors.pending,stats.pending);write("\n");this.cursorUp(this.numberOfLines)};NyanCat.prototype.appendRainbow=function(){var segment=this.tick?"_":"-";var rainbowified=this.rainbowify(segment);for(var index=0;index<this.numberOfLines;index++){var trajectory=this.trajectories[index];if(trajectory.length>=this.trajectoryWidthMax)trajectory.shift();trajectory.push(rainbowified)}};NyanCat.prototype.drawRainbow=function(){var self=this;this.trajectories.forEach(function(line,index){write("["+self.scoreboardWidth+"C");write(line.join(""));write("\n")});this.cursorUp(this.numberOfLines)};NyanCat.prototype.drawNyanCat=function(status){var self=this;var startWidth=this.scoreboardWidth+this.trajectories[0].length;[0,1,2,3].forEach(function(index){write("["+startWidth+"C");switch(index){case 0:write("_,------,");write("\n");break;case 1:var padding=self.tick?"  ":"   ";write("_|"+padding+"/\\_/\\ ");write("\n");break;case 2:var padding=self.tick?"_":"__";var tail=self.tick?"~":"^";var face;switch(status){case"pass":face="( ^ .^)";break;case"fail":face="( o .o)";break;default:face="( - .-)"}write(tail+"|"+padding+face+" ");write("\n");break;case 3:var padding=self.tick?" ":"  ";write(padding+'""  "" ');write("\n");break}});this.cursorUp(this.numberOfLines)};NyanCat.prototype.cursorUp=function(n){write("["+n+"A")};NyanCat.prototype.cursorDown=function(n){write("["+n+"B")};NyanCat.prototype.generateColors=function(){var colors=[];for(var i=0;i<6*7;i++){var pi3=Math.floor(Math.PI/3);var n=i*(1/6);var r=Math.floor(3*Math.sin(n)+3);var g=Math.floor(3*Math.sin(n+2*pi3)+3);var b=Math.floor(3*Math.sin(n+4*pi3)+3);colors.push(36*r+6*g+b+16)}return colors};NyanCat.prototype.rainbowify=function(str){var color=this.rainbowColors[this.colorIndex%this.rainbowColors.length];this.colorIndex+=1;return"[38;5;"+color+"m"+str+"[0m"};function write(string){process.stdout.write(string)}NyanCat.prototype=new Base;NyanCat.prototype.constructor=NyanCat});require.register("reporters/progress.js",function(module,exports,require){var Base=require("./base"),cursor=Base.cursor,color=Base.color;exports=module.exports=Progress;Base.colors.progress=90;function Progress(runner,options){Base.call(this,runner);var self=this,options=options||{},stats=this.stats,width=Base.window.width*.5|0,total=runner.total,complete=0,max=Math.max;options.open=options.open||"[";options.complete=options.complete||"▬";options.incomplete=options.incomplete||Base.symbols.dot;options.close=options.close||"]";options.verbose=false;runner.on("start",function(){console.log();cursor.hide()});runner.on("test end",function(){complete++;var incomplete=total-complete,percent=complete/total,n=width*percent|0,i=width-n;cursor.CR();process.stdout.write("[J");process.stdout.write(color("progress","  "+options.open));process.stdout.write(Array(n).join(options.complete));process.stdout.write(Array(i).join(options.incomplete));process.stdout.write(color("progress",options.close));if(options.verbose){process.stdout.write(color("progress"," "+complete+" of "+total))}});runner.on("end",function(){cursor.show();console.log();self.epilogue()})}Progress.prototype=new Base;Progress.prototype.constructor=Progress});require.register("reporters/spec.js",function(module,exports,require){var Base=require("./base"),cursor=Base.cursor,color=Base.color;exports=module.exports=Spec;function Spec(runner){Base.call(this,runner);var self=this,stats=this.stats,indents=0,n=0;function indent(){return Array(indents).join("  ")}runner.on("start",function(){console.log()});runner.on("suite",function(suite){++indents;console.log(color("suite","%s%s"),indent(),suite.title)});runner.on("suite end",function(suite){--indents;if(1==indents)console.log()});runner.on("test",function(test){process.stdout.write(indent()+color("pass","  ◦ "+test.title+": "))});runner.on("pending",function(test){var fmt=indent()+color("pending","  - %s");console.log(fmt,test.title)});runner.on("pass",function(test){if("fast"==test.speed){var fmt=indent()+color("checkmark","  "+Base.symbols.ok)+color("pass"," %s ");cursor.CR();console.log(fmt,test.title)}else{var fmt=indent()+color("checkmark","  "+Base.symbols.ok)+color("pass"," %s ")+color(test.speed,"(%dms)");cursor.CR();console.log(fmt,test.title,test.duration)}});runner.on("fail",function(test,err){cursor.CR();console.log(indent()+color("fail","  %d) %s"),++n,test.title)});runner.on("end",self.epilogue.bind(self))}Spec.prototype=new Base;Spec.prototype.constructor=Spec});require.register("reporters/tap.js",function(module,exports,require){var Base=require("./base"),cursor=Base.cursor,color=Base.color;exports=module.exports=TAP;function TAP(runner){Base.call(this,runner);var self=this,stats=this.stats,n=1,passes=0,failures=1;runner.on("start",function(){var total=runner.grepTotal(runner.suite);console.log("%d..%d",1,total)});runner.on("test end",function(){++n});runner.on("pending",function(test){console.log("ok %d %s # SKIP -",n,title(test))});runner.on("pass",function(test){passes++;console.log("ok %d %s",n,title(test))});runner.on("fail",function(test,err){failures++;console.log("not ok %d %s",n,title(test));console.log(err.stack.replace(/^/gm,"  "))});runner.on("end",function(){console.log("# tests "+(passes+failures));console.log("# pass "+passes);console.log("# fail "+failures)})}function title(test){return test.fullTitle().replace(/#/g,"")}});require.register("reporters/teamcity.js",function(module,exports,require){var Base=require("./base");exports=module.exports=Teamcity;function Teamcity(runner){Base.call(this,runner);var stats=this.stats;runner.on("start",function(){console.log("##teamcity[testSuiteStarted name='mocha.suite']")});runner.on("test",function(test){console.log("##teamcity[testStarted name='"+escape(test.fullTitle())+"']")});runner.on("fail",function(test,err){console.log("##teamcity[testFailed name='"+escape(test.fullTitle())+"' message='"+escape(err.message)+"']")});runner.on("pending",function(test){console.log("##teamcity[testIgnored name='"+escape(test.fullTitle())+"' message='pending']")});runner.on("test end",function(test){console.log("##teamcity[testFinished name='"+escape(test.fullTitle())+"' duration='"+test.duration+"']")});runner.on("end",function(){console.log("##teamcity[testSuiteFinished name='mocha.suite' duration='"+stats.duration+"']")})}function escape(str){return str.replace(/\|/g,"||").replace(/\n/g,"|n").replace(/\r/g,"|r").replace(/\[/g,"|[").replace(/\]/g,"|]").replace(/\u0085/g,"|x").replace(/\u2028/g,"|l").replace(/\u2029/g,"|p").replace(/'/g,"|'")}});require.register("reporters/xunit.js",function(module,exports,require){var Base=require("./base"),utils=require("../utils"),escape=utils.escape;var Date=global.Date,setTimeout=global.setTimeout,setInterval=global.setInterval,clearTimeout=global.clearTimeout,clearInterval=global.clearInterval;exports=module.exports=XUnit;function XUnit(runner){Base.call(this,runner);var stats=this.stats,tests=[],self=this;runner.on("pass",function(test){tests.push(test)});runner.on("fail",function(test){tests.push(test)});runner.on("end",function(){console.log(tag("testsuite",{name:"Mocha Tests",tests:stats.tests,failures:stats.failures,errors:stats.failures,skip:stats.tests-stats.failures-stats.passes,timestamp:(new Date).toUTCString(),time:stats.duration/1e3},false));tests.forEach(test);console.log("</testsuite>")})}XUnit.prototype=new Base;XUnit.prototype.constructor=XUnit;function test(test){var attrs={classname:test.parent.fullTitle(),name:test.title,time:test.duration/1e3};if("failed"==test.state){var err=test.err;attrs.message=escape(err.message);console.log(tag("testcase",attrs,false,tag("failure",attrs,false,cdata(err.stack))))}else if(test.pending){console.log(tag("testcase",attrs,false,tag("skipped",{},true)))}else{console.log(tag("testcase",attrs,true))}}function tag(name,attrs,close,content){var end=close?"/>":">",pairs=[],tag;for(var key in attrs){pairs.push(key+'="'+escape(attrs[key])+'"')}tag="<"+name+(pairs.length?" "+pairs.join(" "):"")+end;if(content)tag+=content+"</"+name+end;return tag}function cdata(str){return"<![CDATA["+escape(str)+"]]>"}});require.register("runnable.js",function(module,exports,require){var EventEmitter=require("browser/events").EventEmitter,debug=require("browser/debug")("mocha:runnable"),milliseconds=require("./ms");var Date=global.Date,setTimeout=global.setTimeout,setInterval=global.setInterval,clearTimeout=global.clearTimeout,clearInterval=global.clearInterval;var toString=Object.prototype.toString;module.exports=Runnable;function Runnable(title,fn){this.title=title;this.fn=fn;this.async=fn&&fn.length;this.sync=!this.async;this._timeout=2e3;this._slow=75;this.timedOut=false}Runnable.prototype=new EventEmitter;Runnable.prototype.constructor=Runnable;Runnable.prototype.timeout=function(ms){if(0==arguments.length)return this._timeout;if("string"==typeof ms)ms=milliseconds(ms);debug("timeout %d",ms);this._timeout=ms;if(this.timer)this.resetTimeout();return this};Runnable.prototype.slow=function(ms){if(0===arguments.length)return this._slow;if("string"==typeof ms)ms=milliseconds(ms);debug("timeout %d",ms);this._slow=ms;return this};Runnable.prototype.fullTitle=function(){return this.parent.fullTitle()+" "+this.title};Runnable.prototype.clearTimeout=function(){clearTimeout(this.timer)};Runnable.prototype.inspect=function(){return JSON.stringify(this,function(key,val){if("_"==key[0])return;if("parent"==key)return"#<Suite>";if("ctx"==key)return"#<Context>";return val},2)};Runnable.prototype.resetTimeout=function(){var self=this,ms=this.timeout();this.clearTimeout();if(ms){this.timer=setTimeout(function(){self.callback(new Error("timeout of "+ms+"ms exceeded"));self.timedOut=true},ms)}};Runnable.prototype.run=function(fn){var self=this,ms=this.timeout(),start=new Date,ctx=this.ctx,finished,emitted;if(ctx)ctx.runnable(this);if(this.async){if(ms){this.timer=setTimeout(function(){done(new Error("timeout of "+ms+"ms exceeded"));self.timedOut=true},ms)}}function multiple(err){if(emitted)return;emitted=true;self.emit("error",err||new Error("done() called multiple times"))}function done(err){if(self.timedOut)return;if(finished)return multiple(err);self.clearTimeout();self.duration=new Date-start;finished=true;fn(err)}this.callback=done;if(this.async){try{this.fn.call(ctx,function(err){if(toString.call(err)==="[object Error]")return done(err);if(null!=err)return done(new Error("done() invoked with non-Error: "+err));done()})}catch(err){done(err)}return}if(this.asyncOnly){return done(new Error("--async-only option in use without declaring `done()`"))}try{if(!this.pending)this.fn.call(ctx);this.duration=new Date-start;fn()}catch(err){fn(err)}}});require.register("runner.js",function(module,exports,require){var EventEmitter=require("browser/events").EventEmitter,debug=require("browser/debug")("mocha:runner"),Test=require("./test"),utils=require("./utils"),filter=utils.filter,keys=utils.keys,noop=function(){};var globals=["setTimeout","clearTimeout","setInterval","clearInterval","XMLHttpRequest","Date"];module.exports=Runner;function Runner(suite){var self=this;this._globals=[];this.suite=suite;this.total=suite.total();this.failures=0;this.on("test end",function(test){self.checkGlobals(test)});this.on("hook end",function(hook){self.checkGlobals(hook)});this.grep(/.*/);this.globals(this.globalProps().concat(["errno"]))}Runner.prototype=new EventEmitter;Runner.prototype.constructor=Runner;Runner.prototype.grep=function(re,invert){debug("grep %s",re);this._grep=re;this._invert=invert;this.total=this.grepTotal(this.suite);return this};Runner.prototype.grepTotal=function(suite){var self=this;var total=0;suite.eachTest(function(test){var match=self._grep.test(test.fullTitle());if(self._invert)match=!match;if(match)total++});return total};Runner.prototype.globalProps=function(){var props=utils.keys(global);for(var i=0;i<globals.length;++i){if(~utils.indexOf(props,globals[i]))continue;props.push(globals[i])}return props};Runner.prototype.globals=function(arr){if(0==arguments.length)return this._globals;debug("globals %j",arr);utils.forEach(arr,function(arr){this._globals.push(arr)},this);return this};Runner.prototype.checkGlobals=function(test){if(this.ignoreLeaks)return;var ok=this._globals;var globals=this.globalProps();var isNode=process.kill;var leaks;if(isNode&&1==ok.length-globals.length)return;else if(2==ok.length-globals.length)return;leaks=filterLeaks(ok,globals);this._globals=this._globals.concat(leaks);if(leaks.length>1){this.fail(test,new Error("global leaks detected: "+leaks.join(", ")+""))}else if(leaks.length){this.fail(test,new Error("global leak detected: "+leaks[0]))}};Runner.prototype.fail=function(test,err){++this.failures;test.state="failed";if("string"==typeof err){err=new Error('the string "'+err+'" was thrown, throw an Error :)')}this.emit("fail",test,err)};Runner.prototype.failHook=function(hook,err){this.fail(hook,err);this.emit("end")};Runner.prototype.hook=function(name,fn){var suite=this.suite,hooks=suite["_"+name],self=this,timer;function next(i){var hook=hooks[i];if(!hook)return fn();self.currentRunnable=hook;self.emit("hook",hook);hook.on("error",function(err){self.failHook(hook,err)});hook.run(function(err){hook.removeAllListeners("error");var testError=hook.error();if(testError)self.fail(self.test,testError);if(err)return self.failHook(hook,err);self.emit("hook end",hook);next(++i)})}process.nextTick(function(){next(0)})};Runner.prototype.hooks=function(name,suites,fn){var self=this,orig=this.suite;function next(suite){self.suite=suite;if(!suite){self.suite=orig;return fn()}self.hook(name,function(err){if(err){self.suite=orig;return fn(err)}next(suites.pop())})}next(suites.pop())};Runner.prototype.hookUp=function(name,fn){var suites=[this.suite].concat(this.parents()).reverse();this.hooks(name,suites,fn)};Runner.prototype.hookDown=function(name,fn){var suites=[this.suite].concat(this.parents());this.hooks(name,suites,fn)};Runner.prototype.parents=function(){var suite=this.suite,suites=[];while(suite=suite.parent)suites.push(suite);return suites};Runner.prototype.runTest=function(fn){var test=this.test,self=this;if(this.asyncOnly)test.asyncOnly=true;try{test.on("error",function(err){self.fail(test,err)});test.run(fn)}catch(err){fn(err)}};Runner.prototype.runTests=function(suite,fn){var self=this,tests=suite.tests.slice(),test;function next(err){if(self.failures&&suite._bail)return fn();test=tests.shift();if(!test)return fn();var match=self._grep.test(test.fullTitle());if(self._invert)match=!match;if(!match)return next();if(test.pending){self.emit("pending",test);self.emit("test end",test);return next()}self.emit("test",self.test=test);self.hookDown("beforeEach",function(){self.currentRunnable=self.test;self.runTest(function(err){test=self.test;if(err){self.fail(test,err);self.emit("test end",test);return self.hookUp("afterEach",next)}test.state="passed";self.emit("pass",test);self.emit("test end",test);self.hookUp("afterEach",next)})})}this.next=next;next()};Runner.prototype.runSuite=function(suite,fn){var total=this.grepTotal(suite),self=this,i=0;debug("run suite %s",suite.fullTitle());if(!total)return fn();this.emit("suite",this.suite=suite);function next(){var curr=suite.suites[i++];if(!curr)return done();self.runSuite(curr,next)}function done(){self.suite=suite;self.hook("afterAll",function(){self.emit("suite end",suite);fn()})}this.hook("beforeAll",function(){self.runTests(suite,next)})};Runner.prototype.uncaught=function(err){debug("uncaught exception %s",err.message);var runnable=this.currentRunnable;if(!runnable||"failed"==runnable.state)return;runnable.clearTimeout();err.uncaught=true;this.fail(runnable,err);if("test"==runnable.type){this.emit("test end",runnable);this.hookUp("afterEach",this.next);return}this.emit("end")};Runner.prototype.run=function(fn){var self=this,fn=fn||function(){};debug("start");this.on("end",function(){debug("end");process.removeListener("uncaughtException",function(err){self.uncaught(err)});fn(self.failures)});this.emit("start");this.runSuite(this.suite,function(){debug("finished running");self.emit("end")});process.on("uncaughtException",function(err){self.uncaught(err)});return this};function filterLeaks(ok,globals){return filter(globals,function(key){var matched=filter(ok,function(ok){if(~ok.indexOf("*"))return 0==key.indexOf(ok.split("*")[0]);if(/^mocha-/.test(key))return true;return key==ok});return matched.length==0&&(!global.navigator||"onerror"!==key)})}});require.register("suite.js",function(module,exports,require){var EventEmitter=require("browser/events").EventEmitter,debug=require("browser/debug")("mocha:suite"),milliseconds=require("./ms"),utils=require("./utils"),Hook=require("./hook");exports=module.exports=Suite;exports.create=function(parent,title){var suite=new Suite(title,parent.ctx);suite.parent=parent;if(parent.pending)suite.pending=true;title=suite.fullTitle();parent.addSuite(suite);return suite};function Suite(title,ctx){this.title=title;this.ctx=ctx;this.suites=[];this.tests=[];this.pending=false;this._beforeEach=[];this._beforeAll=[];this._afterEach=[];this._afterAll=[];this.root=!title;this._timeout=2e3;this._slow=75;this._bail=false}Suite.prototype=new EventEmitter;Suite.prototype.constructor=Suite;Suite.prototype.clone=function(){var suite=new Suite(this.title);debug("clone");suite.ctx=this.ctx;suite.timeout(this.timeout());suite.slow(this.slow());suite.bail(this.bail());return suite};Suite.prototype.timeout=function(ms){if(0==arguments.length)return this._timeout;if("string"==typeof ms)ms=milliseconds(ms);debug("timeout %d",ms);this._timeout=parseInt(ms,10);return this};Suite.prototype.slow=function(ms){if(0===arguments.length)return this._slow;if("string"==typeof ms)ms=milliseconds(ms);debug("slow %d",ms);this._slow=ms;return this};Suite.prototype.bail=function(bail){if(0==arguments.length)return this._bail;debug("bail %s",bail);this._bail=bail;return this};Suite.prototype.beforeAll=function(fn){if(this.pending)return this;var hook=new Hook('"before all" hook',fn);hook.parent=this;hook.timeout(this.timeout());hook.slow(this.slow());hook.ctx=this.ctx;this._beforeAll.push(hook);this.emit("beforeAll",hook);return this};Suite.prototype.afterAll=function(fn){if(this.pending)return this;var hook=new Hook('"after all" hook',fn);hook.parent=this;hook.timeout(this.timeout());hook.slow(this.slow());hook.ctx=this.ctx;this._afterAll.push(hook);this.emit("afterAll",hook);return this};Suite.prototype.beforeEach=function(fn){if(this.pending)return this;var hook=new Hook('"before each" hook',fn);hook.parent=this;hook.timeout(this.timeout());hook.slow(this.slow());hook.ctx=this.ctx;this._beforeEach.push(hook);this.emit("beforeEach",hook);return this};Suite.prototype.afterEach=function(fn){if(this.pending)return this;var hook=new Hook('"after each" hook',fn);hook.parent=this;hook.timeout(this.timeout());hook.slow(this.slow());hook.ctx=this.ctx;this._afterEach.push(hook);this.emit("afterEach",hook);return this};Suite.prototype.addSuite=function(suite){suite.parent=this;suite.timeout(this.timeout());suite.slow(this.slow());suite.bail(this.bail());this.suites.push(suite);this.emit("suite",suite);return this};Suite.prototype.addTest=function(test){test.parent=this;test.timeout(this.timeout());test.slow(this.slow());test.ctx=this.ctx;this.tests.push(test);this.emit("test",test);return this};Suite.prototype.fullTitle=function(){if(this.parent){var full=this.parent.fullTitle();if(full)return full+" "+this.title}return this.title};Suite.prototype.total=function(){return utils.reduce(this.suites,function(sum,suite){return sum+suite.total()},0)+this.tests.length};Suite.prototype.eachTest=function(fn){utils.forEach(this.tests,fn);utils.forEach(this.suites,function(suite){suite.eachTest(fn)});return this}});require.register("test.js",function(module,exports,require){var Runnable=require("./runnable");module.exports=Test;function Test(title,fn){Runnable.call(this,title,fn);this.pending=!fn;this.type="test"}Test.prototype=new Runnable;Test.prototype.constructor=Test});require.register("utils.js",function(module,exports,require){var fs=require("browser/fs"),path=require("browser/path"),join=path.join,debug=require("browser/debug")("mocha:watch");var ignore=["node_modules",".git"];exports.escape=function(html){return String(html).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};exports.forEach=function(arr,fn,scope){for(var i=0,l=arr.length;i<l;i++)fn.call(scope,arr[i],i)};exports.indexOf=function(arr,obj,start){for(var i=start||0,l=arr.length;i<l;i++){if(arr[i]===obj)return i}return-1};exports.reduce=function(arr,fn,val){var rval=val;for(var i=0,l=arr.length;i<l;i++){rval=fn(rval,arr[i],i,arr)}return rval};exports.filter=function(arr,fn){var ret=[];for(var i=0,l=arr.length;i<l;i++){var val=arr[i];if(fn(val,i,arr))ret.push(val)}return ret};exports.keys=Object.keys||function(obj){var keys=[],has=Object.prototype.hasOwnProperty;for(var key in obj){if(has.call(obj,key)){keys.push(key)}}return keys};exports.watch=function(files,fn){var options={interval:100};files.forEach(function(file){debug("file %s",file);fs.watchFile(file,options,function(curr,prev){if(prev.mtime<curr.mtime)fn(file)})})};function ignored(path){return!~ignore.indexOf(path)}exports.files=function(dir,ret){ret=ret||[];fs.readdirSync(dir).filter(ignored).forEach(function(path){path=join(dir,path);if(fs.statSync(path).isDirectory()){exports.files(path,ret)}else if(path.match(/\.(js|coffee)$/)){ret.push(path)}});return ret};exports.slug=function(str){return str.toLowerCase().replace(/ +/g,"-").replace(/[^-\w]/g,"")};exports.clean=function(str){str=str.replace(/^function *\(.*\) *{/,"").replace(/\s+\}$/,"");var spaces=str.match(/^\n?( *)/)[1].length,re=new RegExp("^ {"+spaces+"}","gm");str=str.replace(re,"");return exports.trim(str)};exports.escapeRegexp=function(str){return str.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")};exports.trim=function(str){return str.replace(/^\s+|\s+$/g,"")};exports.parseQuery=function(qs){return exports.reduce(qs.replace("?","").split("&"),function(obj,pair){var i=pair.indexOf("="),key=pair.slice(0,i),val=pair.slice(++i);obj[key]=decodeURIComponent(val);return obj},{})};function highlight(js){return js.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\/\/(.*)/gm,'<span class="comment">//$1</span>').replace(/('.*?')/gm,'<span class="string">$1</span>').replace(/(\d+\.\d+)/gm,'<span class="number">$1</span>').replace(/(\d+)/gm,'<span class="number">$1</span>').replace(/\bnew *(\w+)/gm,'<span class="keyword">new</span> <span class="init">$1</span>').replace(/\b(function|new|throw|return|var|if|else)\b/gm,'<span class="keyword">$1</span>')}exports.highlightTags=function(name){var code=document.getElementsByTagName(name);for(var i=0,len=code.length;i<len;++i){code[i].innerHTML=highlight(code[i].innerHTML)}}});process={};process.exit=function(status){};process.stdout={};global=window;process.nextTick=function(){if(window.ActiveXObject||!window.postMessage){return function(fn){fn()}}var timeouts=[],name="mocha-zero-timeout";window.addEventListener("message",function(e){if(e.source==window&&e.data==name){if(e.stopPropagation)e.stopPropagation();if(timeouts.length)timeouts.shift()()}},true);return function(fn){timeouts.push(fn);window.postMessage(name,"*")}}();process.removeListener=function(e){if("uncaughtException"==e){window.onerror=null}};process.on=function(e,fn){if("uncaughtException"==e){window.onerror=function(err,url,line){fn(new Error(err+" ("+url+":"+line+")"))}}};(function(){var Mocha=window.Mocha=require("mocha"),mocha=window.mocha=new Mocha({reporter:"html"});mocha.ui=function(ui){Mocha.prototype.ui.call(this,ui);this.suite.emit("pre-require",window,null,this);return this};mocha.setup=function(opts){if("string"==typeof opts)opts={ui:opts};for(var opt in opts)this[opt](opts[opt]);return this};mocha.run=function(fn){var options=mocha.options;mocha.globals("location");var query=Mocha.utils.parseQuery(window.location.search||"");if(query.grep)mocha.grep(query.grep);if(query.invert)mocha.invert();return Mocha.prototype.run.call(mocha,function(){Mocha.utils.highlightTags("code");if(fn)fn()})}})()})();var sinon=function(){"use strict";var buster=function(setTimeout,B){var isNode=typeof require=="function"&&typeof module=="object";var div=typeof document!="undefined"&&document.createElement("div");var F=function(){};var buster={bind:function bind(obj,methOrProp){var method=typeof methOrProp=="string"?obj[methOrProp]:methOrProp;var args=Array.prototype.slice.call(arguments,2);return function(){var allArgs=args.concat(Array.prototype.slice.call(arguments));return method.apply(obj,allArgs)}},partial:function partial(fn){var args=[].slice.call(arguments,1);return function(){return fn.apply(this,args.concat([].slice.call(arguments)))}},create:function create(object){F.prototype=object;return new F},extend:function extend(target){if(!target){return}for(var i=1,l=arguments.length,prop;i<l;++i){for(prop in arguments[i]){target[prop]=arguments[i][prop]}}return target},nextTick:function nextTick(callback){if(typeof process!="undefined"&&process.nextTick){return process.nextTick(callback)}setTimeout(callback,0)},functionName:function functionName(func){if(!func)return"";if(func.displayName)return func.displayName;if(func.name)return func.name;var matches=func.toString().match(/function\s+([^\(]+)/m);return matches&&matches[1]||""},isNode:function isNode(obj){if(!div)return false;try{obj.appendChild(div);obj.removeChild(div)}catch(e){return false}return true},isElement:function isElement(obj){return obj&&obj.nodeType===1&&buster.isNode(obj)},isArray:function isArray(arr){return Object.prototype.toString.call(arr)=="[object Array]"},flatten:function flatten(arr){var result=[],arr=arr||[];for(var i=0,l=arr.length;i<l;++i){result=result.concat(buster.isArray(arr[i])?flatten(arr[i]):arr[i])}return result},each:function each(arr,callback){for(var i=0,l=arr.length;i<l;++i){callback(arr[i])}},map:function map(arr,callback){var results=[];for(var i=0,l=arr.length;i<l;++i){results.push(callback(arr[i]))}return results},parallel:function parallel(fns,callback){function cb(err,res){if(typeof callback=="function"){callback(err,res);callback=null}}if(fns.length==0){return cb(null,[])}var remaining=fns.length,results=[];function makeDone(num){return function done(err,result){if(err){return cb(err)}results[num]=result;if(--remaining==0){cb(null,results)}}}for(var i=0,l=fns.length;i<l;++i){fns[i](makeDone(i))}},series:function series(fns,callback){function cb(err,res){if(typeof callback=="function"){callback(err,res)}}var remaining=fns.slice();var results=[];function callNext(){if(remaining.length==0)return cb(null,results);var promise=remaining.shift()(next);if(promise&&typeof promise.then=="function"){promise.then(buster.partial(next,null),next)}}function next(err,result){if(err)return cb(err);results.push(result);callNext()}callNext()},countdown:function countdown(num,done){return function(){if(--num==0)done()}}};if(typeof process==="object"&&typeof require==="function"&&typeof module==="object"){var crypto=require("crypto");var path=require("path");buster.tmpFile=function(fileName){var hashed=crypto.createHash("sha1");hashed.update(fileName);var tmpfileName=hashed.digest("hex");if(process.platform=="win32"){return path.join(process.env["TEMP"],tmpfileName)}else{return path.join("/tmp",tmpfileName)}}}if(Array.prototype.some){buster.some=function(arr,fn,thisp){return arr.some(fn,thisp)}}else{buster.some=function(arr,fun,thisp){if(arr==null){throw new TypeError}arr=Object(arr);var len=arr.length>>>0;if(typeof fun!=="function"){throw new TypeError}for(var i=0;i<len;i++){if(arr.hasOwnProperty(i)&&fun.call(thisp,arr[i],i,arr)){return true}}return false}}if(Array.prototype.filter){buster.filter=function(arr,fn,thisp){return arr.filter(fn,thisp)}}else{buster.filter=function(fn,thisp){if(this==null){throw new TypeError}var t=Object(this);var len=t.length>>>0;if(typeof fn!="function"){throw new TypeError}var res=[];for(var i=0;i<len;i++){if(i in t){var val=t[i];if(fn.call(thisp,val,i,t)){res.push(val)}}}return res}}if(isNode){module.exports=buster;buster.eventEmitter=require("./buster-event-emitter");Object.defineProperty(buster,"defineVersionGetter",{get:function(){return require("./define-version-getter")}})}return buster.extend(B||{},buster)}(setTimeout,buster);if(typeof buster==="undefined"){var buster={}}if(typeof module==="object"&&typeof require==="function"){buster=require("buster-core")}buster.format=buster.format||{};buster.format.excludeConstructors=["Object",/^.$/];buster.format.quoteStrings=true;buster.format.ascii=function(){var hasOwn=Object.prototype.hasOwnProperty;var specialObjects=[];if(typeof global!="undefined"){specialObjects.push({obj:global,value:"[object global]"})}if(typeof document!="undefined"){specialObjects.push({obj:document,value:"[object HTMLDocument]"})}if(typeof window!="undefined"){specialObjects.push({obj:window,value:"[object Window]"})}function keys(object){var k=Object.keys&&Object.keys(object)||[];if(k.length==0){for(var prop in object){if(hasOwn.call(object,prop)){k.push(prop)}}}return k.sort()}function isCircular(object,objects){if(typeof object!="object"){return false}for(var i=0,l=objects.length;i<l;++i){if(objects[i]===object){return true}}return false}function ascii(object,processed,indent){if(typeof object=="string"){var quote=typeof this.quoteStrings!="boolean"||this.quoteStrings;return processed||quote?'"'+object+'"':object}if(typeof object=="function"&&!(object instanceof RegExp)){return ascii.func(object)}processed=processed||[];if(isCircular(object,processed)){return"[Circular]"}if(Object.prototype.toString.call(object)=="[object Array]"){return ascii.array.call(this,object,processed)}if(!object){return""+object}if(buster.isElement(object)){return ascii.element(object)}if(typeof object.toString=="function"&&object.toString!==Object.prototype.toString){return object.toString()}for(var i=0,l=specialObjects.length;i<l;i++){if(object===specialObjects[i].obj){return specialObjects[i].value}}return ascii.object.call(this,object,processed,indent)}ascii.func=function(func){return"function "+buster.functionName(func)+"() {}"};ascii.array=function(array,processed){processed=processed||[];processed.push(array);var pieces=[];
for(var i=0,l=array.length;i<l;++i){pieces.push(ascii.call(this,array[i],processed))}return"["+pieces.join(", ")+"]"};ascii.object=function(object,processed,indent){processed=processed||[];processed.push(object);indent=indent||0;var pieces=[],properties=keys(object),prop,str,obj;var is="";var length=3;for(var i=0,l=indent;i<l;++i){is+=" "}for(i=0,l=properties.length;i<l;++i){prop=properties[i];obj=object[prop];if(isCircular(obj,processed)){str="[Circular]"}else{str=ascii.call(this,obj,processed,indent+2)}str=(/\s/.test(prop)?'"'+prop+'"':prop)+": "+str;length+=str.length;pieces.push(str)}var cons=ascii.constructorName.call(this,object);var prefix=cons?"["+cons+"] ":"";return length+indent>80?prefix+"{\n  "+is+pieces.join(",\n  "+is)+"\n"+is+"}":prefix+"{ "+pieces.join(", ")+" }"};ascii.element=function(element){var tagName=element.tagName.toLowerCase();var attrs=element.attributes,attribute,pairs=[],attrName;for(var i=0,l=attrs.length;i<l;++i){attribute=attrs.item(i);attrName=attribute.nodeName.toLowerCase().replace("html:","");if(attrName=="contenteditable"&&attribute.nodeValue=="inherit"){continue}if(!!attribute.nodeValue){pairs.push(attrName+'="'+attribute.nodeValue+'"')}}var formatted="<"+tagName+(pairs.length>0?" ":"");var content=element.innerHTML;if(content.length>20){content=content.substr(0,20)+"[...]"}var res=formatted+pairs.join(" ")+">"+content+"</"+tagName+">";return res.replace(/ contentEditable="inherit"/,"")};ascii.constructorName=function(object){var name=buster.functionName(object&&object.constructor);var excludes=this.excludeConstructors||buster.format.excludeConstructors||[];for(var i=0,l=excludes.length;i<l;++i){if(typeof excludes[i]=="string"&&excludes[i]==name){return""}else if(excludes[i].test&&excludes[i].test(name)){return""}}return name};return ascii}();if(typeof module!="undefined"){module.exports=buster.format}var sinon=function(buster){var div=typeof document!="undefined"&&document.createElement("div");var hasOwn=Object.prototype.hasOwnProperty;function isDOMNode(obj){var success=false;try{obj.appendChild(div);success=div.parentNode==obj}catch(e){return false}finally{try{obj.removeChild(div)}catch(e){}}return success}function isElement(obj){return div&&obj&&obj.nodeType===1&&isDOMNode(obj)}function isFunction(obj){return typeof obj==="function"||!!(obj&&obj.constructor&&obj.call&&obj.apply)}function mirrorProperties(target,source){for(var prop in source){if(!hasOwn.call(target,prop)){target[prop]=source[prop]}}}var sinon={wrapMethod:function wrapMethod(object,property,method){if(!object){throw new TypeError("Should wrap property of object")}if(typeof method!="function"){throw new TypeError("Method wrapper should be function")}var wrappedMethod=object[property];if(!isFunction(wrappedMethod)){throw new TypeError("Attempted to wrap "+typeof wrappedMethod+" property "+property+" as function")}if(wrappedMethod.restore&&wrappedMethod.restore.sinon){throw new TypeError("Attempted to wrap "+property+" which is already wrapped")}if(wrappedMethod.calledBefore){var verb=!!wrappedMethod.returns?"stubbed":"spied on";throw new TypeError("Attempted to wrap "+property+" which is already "+verb)}var owned=hasOwn.call(object,property);object[property]=method;method.displayName=property;method.restore=function(){if(!owned){delete object[property]}if(object[property]===method){object[property]=wrappedMethod}};method.restore.sinon=true;mirrorProperties(method,wrappedMethod);return method},extend:function extend(target){for(var i=1,l=arguments.length;i<l;i+=1){for(var prop in arguments[i]){if(arguments[i].hasOwnProperty(prop)){target[prop]=arguments[i][prop]}if(arguments[i].hasOwnProperty("toString")&&arguments[i].toString!=target.toString){target.toString=arguments[i].toString}}}return target},create:function create(proto){var F=function(){};F.prototype=proto;return new F},deepEqual:function deepEqual(a,b){if(sinon.match&&sinon.match.isMatcher(a)){return a.test(b)}if(typeof a!="object"||typeof b!="object"){return a===b}if(isElement(a)||isElement(b)){return a===b}if(a===b){return true}if(a===null&&b!==null||a!==null&&b===null){return false}var aString=Object.prototype.toString.call(a);if(aString!=Object.prototype.toString.call(b)){return false}if(aString=="[object Array]"){if(a.length!==b.length){return false}for(var i=0,l=a.length;i<l;i+=1){if(!deepEqual(a[i],b[i])){return false}}return true}var prop,aLength=0,bLength=0;for(prop in a){aLength+=1;if(!deepEqual(a[prop],b[prop])){return false}}for(prop in b){bLength+=1}if(aLength!=bLength){return false}return true},functionName:function functionName(func){var name=func.displayName||func.name;if(!name){var matches=func.toString().match(/function ([^\s\(]+)/);name=matches&&matches[1]}return name},functionToString:function toString(){if(this.getCall&&this.callCount){var thisValue,prop,i=this.callCount;while(i--){thisValue=this.getCall(i).thisValue;for(prop in thisValue){if(thisValue[prop]===this){return prop}}}}return this.displayName||"sinon fake"},getConfig:function(custom){var config={};custom=custom||{};var defaults=sinon.defaultConfig;for(var prop in defaults){if(defaults.hasOwnProperty(prop)){config[prop]=custom.hasOwnProperty(prop)?custom[prop]:defaults[prop]}}return config},format:function(val){return""+val},defaultConfig:{injectIntoThis:true,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:true,useFakeServer:true},timesInWords:function timesInWords(count){return count==1&&"once"||count==2&&"twice"||count==3&&"thrice"||(count||0)+" times"},calledInOrder:function(spies){for(var i=1,l=spies.length;i<l;i++){if(!spies[i-1].calledBefore(spies[i])){return false}}return true},orderByFirstCall:function(spies){return spies.sort(function(a,b){var aCall=a.getCall(0);var bCall=b.getCall(0);var aId=aCall&&aCall.callId||-1;var bId=bCall&&bCall.callId||-1;return aId<bId?-1:1})},log:function(){},logError:function(label,err){var msg=label+" threw exception: ";sinon.log(msg+"["+err.name+"] "+err.message);if(err.stack){sinon.log(err.stack)}setTimeout(function(){err.message=msg+err.message;throw err},0)},typeOf:function(value){if(value===null){return"null"}else if(value===undefined){return"undefined"}var string=Object.prototype.toString.call(value);return string.substring(8,string.length-1).toLowerCase()}};var isNode=typeof module=="object"&&typeof require=="function";if(isNode){try{buster={format:require("buster-format")}}catch(e){}module.exports=sinon;module.exports.spy=require("./sinon/spy");module.exports.stub=require("./sinon/stub");module.exports.mock=require("./sinon/mock");module.exports.collection=require("./sinon/collection");module.exports.assert=require("./sinon/assert");module.exports.sandbox=require("./sinon/sandbox");module.exports.test=require("./sinon/test");module.exports.testCase=require("./sinon/test_case");module.exports.assert=require("./sinon/assert");module.exports.match=require("./sinon/match")}if(buster){var formatter=sinon.create(buster.format);formatter.quoteStrings=false;sinon.format=function(){return formatter.ascii.apply(formatter,arguments)}}else if(isNode){try{var util=require("util");sinon.format=function(value){return typeof value=="object"&&value.toString===Object.prototype.toString?util.inspect(value):value}}catch(e){}}return sinon}(typeof buster=="object"&&buster);(function(sinon){var commonJSModule=typeof module=="object"&&typeof require=="function";if(!sinon&&commonJSModule){sinon=require("../sinon")}if(!sinon){return}function assertType(value,type,name){var actual=sinon.typeOf(value);if(actual!==type){throw new TypeError("Expected type of "+name+" to be "+type+", but was "+actual)}}var matcher={toString:function(){return this.message}};function isMatcher(object){return matcher.isPrototypeOf(object)}function matchObject(expectation,actual){if(actual===null||actual===undefined){return false}for(var key in expectation){if(expectation.hasOwnProperty(key)){var exp=expectation[key];var act=actual[key];if(match.isMatcher(exp)){if(!exp.test(act)){return false}}else if(sinon.typeOf(exp)==="object"){if(!matchObject(exp,act)){return false}}else if(!sinon.deepEqual(exp,act)){return false}}}return true}matcher.or=function(m2){if(!isMatcher(m2)){throw new TypeError("Matcher expected")}var m1=this;var or=sinon.create(matcher);or.test=function(actual){return m1.test(actual)||m2.test(actual)};or.message=m1.message+".or("+m2.message+")";return or};matcher.and=function(m2){if(!isMatcher(m2)){throw new TypeError("Matcher expected")}var m1=this;var and=sinon.create(matcher);and.test=function(actual){return m1.test(actual)&&m2.test(actual)};and.message=m1.message+".and("+m2.message+")";return and};var match=function(expectation,message){var m=sinon.create(matcher);var type=sinon.typeOf(expectation);switch(type){case"object":if(typeof expectation.test==="function"){m.test=function(actual){return expectation.test(actual)===true};m.message="match("+sinon.functionName(expectation.test)+")";return m}var str=[];for(var key in expectation){if(expectation.hasOwnProperty(key)){str.push(key+": "+expectation[key])}}m.test=function(actual){return matchObject(expectation,actual)};m.message="match("+str.join(", ")+")";break;case"number":m.test=function(actual){return expectation==actual};break;case"string":m.test=function(actual){if(typeof actual!=="string"){return false}return actual.indexOf(expectation)!==-1};m.message='match("'+expectation+'")';break;case"regexp":m.test=function(actual){if(typeof actual!=="string"){return false}return expectation.test(actual)};break;case"function":m.test=expectation;if(message){m.message=message}else{m.message="match("+sinon.functionName(expectation)+")"}break;default:m.test=function(actual){return sinon.deepEqual(expectation,actual)}}if(!m.message){m.message="match("+expectation+")"}return m};match.isMatcher=isMatcher;match.any=match(function(){return true},"any");match.defined=match(function(actual){return actual!==null&&actual!==undefined},"defined");match.truthy=match(function(actual){return!!actual},"truthy");match.falsy=match(function(actual){return!actual},"falsy");match.same=function(expectation){return match(function(actual){return expectation===actual},"same("+expectation+")")};match.typeOf=function(type){assertType(type,"string","type");return match(function(actual){return sinon.typeOf(actual)===type},'typeOf("'+type+'")')};match.instanceOf=function(type){assertType(type,"function","type");return match(function(actual){return actual instanceof type},"instanceOf("+sinon.functionName(type)+")")};function createPropertyMatcher(propertyTest,messagePrefix){return function(property,value){assertType(property,"string","property");var onlyProperty=arguments.length===1;var message=messagePrefix+'("'+property+'"';if(!onlyProperty){message+=", "+value}message+=")";return match(function(actual){if(actual===undefined||actual===null||!propertyTest(actual,property)){return false}return onlyProperty||sinon.deepEqual(value,actual[property])},message)}}match.has=createPropertyMatcher(function(actual,property){if(typeof actual==="object"){return property in actual}return actual[property]!==undefined},"has");match.hasOwn=createPropertyMatcher(function(actual,property){return actual.hasOwnProperty(property)},"hasOwn");match.bool=match.typeOf("boolean");match.number=match.typeOf("number");match.string=match.typeOf("string");match.object=match.typeOf("object");match.func=match.typeOf("function");match.array=match.typeOf("array");match.regexp=match.typeOf("regexp");match.date=match.typeOf("date");if(commonJSModule){module.exports=match}else{sinon.match=match}})(typeof sinon=="object"&&sinon||null);(function(sinon){var commonJSModule=typeof module=="object"&&typeof require=="function";var spyCall;var callId=0;var push=[].push;var slice=Array.prototype.slice;if(!sinon&&commonJSModule){sinon=require("../sinon")}if(!sinon){return}function spy(object,property){if(!property&&typeof object=="function"){return spy.create(object)}if(!object&&!property){return spy.create(function(){})}var method=object[property];return sinon.wrapMethod(object,property,spy.create(method))}sinon.extend(spy,function(){function delegateToCalls(api,method,matchAny,actual,notCalled){api[method]=function(){if(!this.called){if(notCalled){return notCalled.apply(this,arguments)}return false}var currentCall;var matches=0;for(var i=0,l=this.callCount;i<l;i+=1){currentCall=this.getCall(i);if(currentCall[actual||method].apply(currentCall,arguments)){matches+=1;if(matchAny){return true}}}return matches===this.callCount}}function matchingFake(fakes,args,strict){if(!fakes){return}var alen=args.length;for(var i=0,l=fakes.length;i<l;i++){if(fakes[i].matches(args,strict)){return fakes[i]}}}function incrementCallCount(){this.called=true;this.callCount+=1;this.notCalled=false;this.calledOnce=this.callCount==1;this.calledTwice=this.callCount==2;this.calledThrice=this.callCount==3}function createCallProperties(){this.firstCall=this.getCall(0);this.secondCall=this.getCall(1);this.thirdCall=this.getCall(2);this.lastCall=this.getCall(this.callCount-1)}var vars="a,b,c,d,e,f,g,h,i,j,k,l";function createProxy(func){var p;if(func.length){eval("p = (function proxy("+vars.substring(0,func.length*2-1)+") { return p.invoke(func, this, slice.call(arguments)); });")}else{p=function proxy(){return p.invoke(func,this,slice.call(arguments))}}return p}var uuid=0;var spyApi={reset:function(){this.called=false;this.notCalled=true;this.calledOnce=false;this.calledTwice=false;this.calledThrice=false;this.callCount=0;this.firstCall=null;this.secondCall=null;this.thirdCall=null;this.lastCall=null;this.args=[];this.returnValues=[];this.thisValues=[];this.exceptions=[];this.callIds=[];if(this.fakes){for(var i=0;i<this.fakes.length;i++){this.fakes[i].reset()}}},create:function create(func){var name;if(typeof func!="function"){func=function(){}}else{name=sinon.functionName(func)}var proxy=createProxy(func);sinon.extend(proxy,spy);delete proxy.create;sinon.extend(proxy,func);proxy.reset();proxy.prototype=func.prototype;proxy.displayName=name||"spy";proxy.toString=sinon.functionToString;proxy._create=sinon.spy.create;proxy.id="spy#"+uuid++;return proxy},invoke:function invoke(func,thisValue,args){var matching=matchingFake(this.fakes,args);var exception,returnValue;incrementCallCount.call(this);push.call(this.thisValues,thisValue);push.call(this.args,args);push.call(this.callIds,callId++);try{if(matching){returnValue=matching.invoke(func,thisValue,args)}else{returnValue=(this.func||func).apply(thisValue,args)}}catch(e){push.call(this.returnValues,undefined);exception=e;throw e}finally{push.call(this.exceptions,exception)}push.call(this.returnValues,returnValue);createCallProperties.call(this);return returnValue},getCall:function getCall(i){if(i<0||i>=this.callCount){return null}return spyCall.create(this,this.thisValues[i],this.args[i],this.returnValues[i],this.exceptions[i],this.callIds[i])},calledBefore:function calledBefore(spyFn){if(!this.called){return false}if(!spyFn.called){return true}return this.callIds[0]<spyFn.callIds[spyFn.callIds.length-1]},calledAfter:function calledAfter(spyFn){if(!this.called||!spyFn.called){return false}return this.callIds[this.callCount-1]>spyFn.callIds[spyFn.callCount-1]},withArgs:function(){var args=slice.call(arguments);if(this.fakes){var match=matchingFake(this.fakes,args,true);if(match){return match}}else{this.fakes=[]}var original=this;var fake=this._create();fake.matchingAguments=args;push.call(this.fakes,fake);fake.withArgs=function(){return original.withArgs.apply(original,arguments)};for(var i=0;i<this.args.length;i++){if(fake.matches(this.args[i])){incrementCallCount.call(fake);push.call(fake.thisValues,this.thisValues[i]);push.call(fake.args,this.args[i]);push.call(fake.returnValues,this.returnValues[i]);push.call(fake.exceptions,this.exceptions[i]);push.call(fake.callIds,this.callIds[i])}}createCallProperties.call(fake);return fake},matches:function(args,strict){var margs=this.matchingAguments;if(margs.length<=args.length&&sinon.deepEqual(margs,args.slice(0,margs.length))){return!strict||margs.length==args.length}},printf:function(format){var spy=this;var args=slice.call(arguments,1);var formatter;return(format||"").replace(/%(.)/g,function(match,specifyer){formatter=spyApi.formatters[specifyer];if(typeof formatter=="function"){return formatter.call(null,spy,args)}else if(!isNaN(parseInt(specifyer),10)){return sinon.format(args[specifyer-1])}return"%"+specifyer})}};delegateToCalls(spyApi,"calledOn",true);delegateToCalls(spyApi,"alwaysCalledOn",false,"calledOn");delegateToCalls(spyApi,"calledWith",true);delegateToCalls(spyApi,"calledWithMatch",true);delegateToCalls(spyApi,"alwaysCalledWith",false,"calledWith");delegateToCalls(spyApi,"alwaysCalledWithMatch",false,"calledWithMatch");delegateToCalls(spyApi,"calledWithExactly",true);delegateToCalls(spyApi,"alwaysCalledWithExactly",false,"calledWithExactly");delegateToCalls(spyApi,"neverCalledWith",false,"notCalledWith",function(){return true});delegateToCalls(spyApi,"neverCalledWithMatch",false,"notCalledWithMatch",function(){return true});delegateToCalls(spyApi,"threw",true);delegateToCalls(spyApi,"alwaysThrew",false,"threw");delegateToCalls(spyApi,"returned",true);delegateToCalls(spyApi,"alwaysReturned",false,"returned");delegateToCalls(spyApi,"calledWithNew",true);delegateToCalls(spyApi,"alwaysCalledWithNew",false,"calledWithNew");delegateToCalls(spyApi,"callArg",false,"callArgWith",function(){throw new Error(this.toString()+" cannot call arg since it was not yet invoked.")});spyApi.callArgWith=spyApi.callArg;delegateToCalls(spyApi,"yield",false,"yield",function(){throw new Error(this.toString()+" cannot yield since it was not yet invoked.")});spyApi.invokeCallback=spyApi.yield;delegateToCalls(spyApi,"yieldTo",false,"yieldTo",function(property){throw new Error(this.toString()+" cannot yield to '"+property+"' since it was not yet invoked.")});spyApi.formatters={c:function(spy){return sinon.timesInWords(spy.callCount)},n:function(spy){return spy.toString()},C:function(spy){var calls=[];for(var i=0,l=spy.callCount;i<l;++i){push.call(calls,"    "+spy.getCall(i).toString())}return calls.length>0?"\n"+calls.join("\n"):""},t:function(spy){var objects=[];for(var i=0,l=spy.callCount;i<l;++i){push.call(objects,sinon.format(spy.thisValues[i]))}return objects.join(", ")},"*":function(spy,args){var formatted=[];for(var i=0,l=args.length;i<l;++i){push.call(formatted,sinon.format(args[i]))}return formatted.join(", ")}};return spyApi}());spyCall=function(){function throwYieldError(proxy,text,args){var msg=sinon.functionName(proxy)+text;if(args.length){msg+=" Received ["+slice.call(args).join(", ")+"]"}throw new Error(msg)}var callApi={create:function create(spy,thisValue,args,returnValue,exception,id){var proxyCall=sinon.create(spyCall);delete proxyCall.create;proxyCall.proxy=spy;proxyCall.thisValue=thisValue;proxyCall.args=args;proxyCall.returnValue=returnValue;proxyCall.exception=exception;proxyCall.callId=typeof id=="number"&&id||callId++;return proxyCall},calledOn:function calledOn(thisValue){if(sinon.match&&sinon.match.isMatcher(thisValue)){return thisValue.test(this.thisValue)}return this.thisValue===thisValue},calledWith:function calledWith(){for(var i=0,l=arguments.length;i<l;i+=1){if(!sinon.deepEqual(arguments[i],this.args[i])){return false}}return true},calledWithMatch:function calledWithMatch(){for(var i=0,l=arguments.length;i<l;i+=1){var actual=this.args[i];var expectation=arguments[i];if(!sinon.match||!sinon.match(expectation).test(actual)){return false}}return true},calledWithExactly:function calledWithExactly(){return arguments.length==this.args.length&&this.calledWith.apply(this,arguments)},notCalledWith:function notCalledWith(){return!this.calledWith.apply(this,arguments)},notCalledWithMatch:function notCalledWithMatch(){return!this.calledWithMatch.apply(this,arguments)},returned:function returned(value){return sinon.deepEqual(value,this.returnValue)},threw:function threw(error){if(typeof error=="undefined"||!this.exception){return!!this.exception}if(typeof error=="string"){return this.exception.name==error}return this.exception===error},calledWithNew:function calledWithNew(thisValue){return this.thisValue instanceof this.proxy},calledBefore:function(other){return this.callId<other.callId},calledAfter:function(other){return this.callId>other.callId},callArg:function(pos){this.args[pos]()},callArgWith:function(pos){var args=slice.call(arguments,1);this.args[pos].apply(null,args)},yield:function(){var args=this.args;for(var i=0,l=args.length;i<l;++i){if(typeof args[i]==="function"){args[i].apply(null,slice.call(arguments));return}}throwYieldError(this.proxy," cannot yield since no callback was passed.",args)},yieldTo:function(prop){var args=this.args;for(var i=0,l=args.length;i<l;++i){if(args[i]&&typeof args[i][prop]==="function"){args[i][prop].apply(null,slice.call(arguments,1));return}}throwYieldError(this.proxy," cannot yield to '"+prop+"' since no callback was passed.",args)},toString:function(){var callStr=this.proxy.toString()+"(";var args=[];for(var i=0,l=this.args.length;i<l;++i){push.call(args,sinon.format(this.args[i]))}callStr=callStr+args.join(", ")+")";if(typeof this.returnValue!="undefined"){callStr+=" => "+sinon.format(this.returnValue)}if(this.exception){callStr+=" !"+this.exception.name;if(this.exception.message){callStr+="("+this.exception.message+")"}}return callStr}};callApi.invokeCallback=callApi.yield;return callApi}();spy.spyCall=spyCall;sinon.spyCall=spyCall;if(commonJSModule){module.exports=spy}else{sinon.spy=spy}})(typeof sinon=="object"&&sinon||null);(function(sinon){var commonJSModule=typeof module=="object"&&typeof require=="function";if(!sinon&&commonJSModule){sinon=require("../sinon")}if(!sinon){return}function stub(object,property,func){if(!!func&&typeof func!="function"){throw new TypeError("Custom stub should be function")}var wrapper;if(func){wrapper=sinon.spy&&sinon.spy.create?sinon.spy.create(func):func}else{wrapper=stub.create()}if(!object&&!property){return sinon.stub.create()}if(!property&&!!object&&typeof object=="object"){for(var prop in object){if(typeof object[prop]==="function"){stub(object,prop)}}return object}return sinon.wrapMethod(object,property,wrapper)}function getChangingValue(stub,property){var index=stub.callCount-1;var prop=index in stub[property]?stub[property][index]:stub[property+"Last"];stub[property+"Last"]=prop;return prop}function getCallback(stub,args){var callArgAt=getChangingValue(stub,"callArgAts");if(callArgAt<0){var callArgProp=getChangingValue(stub,"callArgProps");for(var i=0,l=args.length;i<l;++i){if(!callArgProp&&typeof args[i]=="function"){return args[i]}if(callArgProp&&args[i]&&typeof args[i][callArgProp]=="function"){return args[i][callArgProp]}}return null}return args[callArgAt]}var join=Array.prototype.join;function getCallbackError(stub,func,args){if(stub.callArgAtsLast<0){var msg;if(stub.callArgPropsLast){msg=sinon.functionName(stub)+" expected to yield to '"+stub.callArgPropsLast+"', but no object with such a property was passed."}else{msg=sinon.functionName(stub)+" expected to yield, but no callback was passed."}if(args.length>0){msg+=" Received ["+join.call(args,", ")+"]"}return msg}return"argument at index "+stub.callArgAtsLast+" is not a function: "+func}var nextTick=function(){if(typeof process==="object"&&typeof process.nextTick==="function"){return process.nextTick}else if(typeof msSetImmediate==="function"){return msSetImmediate.bind(window)}else if(typeof setImmediate==="function"){return setImmediate}else{return function(callback){setTimeout(callback,0)}}}();function callCallback(stub,args){if(stub.callArgAts.length>0){var func=getCallback(stub,args);if(typeof func!="function"){throw new TypeError(getCallbackError(stub,func,args))}var index=stub.callCount-1;var callbackArguments=getChangingValue(stub,"callbackArguments");var callbackContext=getChangingValue(stub,"callbackContexts");if(stub.callbackAsync){nextTick(function(){func.apply(callbackContext,callbackArguments)})}else{func.apply(callbackContext,callbackArguments)}}}var uuid=0;sinon.extend(stub,function(){var slice=Array.prototype.slice,proto;function throwsException(error,message){if(typeof error=="string"){this.exception=new Error(message||"");this.exception.name=error}else if(!error){this.exception=new Error("Error")}else{this.exception=error}return this}proto={create:function create(){var functionStub=function(){callCallback(functionStub,arguments);if(functionStub.exception){throw functionStub.exception}else if(typeof functionStub.returnArgAt=="number"){return arguments[functionStub.returnArgAt]}else if(functionStub.returnThis){return this}return functionStub.returnValue};functionStub.id="stub#"+uuid++;var orig=functionStub;functionStub=sinon.spy.create(functionStub);functionStub.func=orig;functionStub.callArgAts=[];functionStub.callbackArguments=[];functionStub.callbackContexts=[];functionStub.callArgProps=[];sinon.extend(functionStub,stub);functionStub._create=sinon.stub.create;functionStub.displayName="stub";functionStub.toString=sinon.functionToString;return functionStub},returns:function returns(value){this.returnValue=value;return this},returnsArg:function returnsArg(pos){if(typeof pos!="number"){throw new TypeError("argument index is not number")}this.returnArgAt=pos;return this},returnsThis:function returnsThis(){this.returnThis=true;return this},"throws":throwsException,throwsException:throwsException,callsArg:function callsArg(pos){if(typeof pos!="number"){throw new TypeError("argument index is not number")}this.callArgAts.push(pos);this.callbackArguments.push([]);this.callbackContexts.push(undefined);this.callArgProps.push(undefined);return this},callsArgOn:function callsArgOn(pos,context){if(typeof pos!="number"){throw new TypeError("argument index is not number")}if(typeof context!="object"){throw new TypeError("argument context is not an object")}this.callArgAts.push(pos);this.callbackArguments.push([]);this.callbackContexts.push(context);this.callArgProps.push(undefined);return this},callsArgWith:function callsArgWith(pos){if(typeof pos!="number"){throw new TypeError("argument index is not number")}this.callArgAts.push(pos);this.callbackArguments.push(slice.call(arguments,1));this.callbackContexts.push(undefined);this.callArgProps.push(undefined);return this},callsArgOnWith:function callsArgWith(pos,context){if(typeof pos!="number"){throw new TypeError("argument index is not number")}if(typeof context!="object"){throw new TypeError("argument context is not an object")}this.callArgAts.push(pos);this.callbackArguments.push(slice.call(arguments,2));this.callbackContexts.push(context);this.callArgProps.push(undefined);return this},yields:function(){this.callArgAts.push(-1);this.callbackArguments.push(slice.call(arguments,0));this.callbackContexts.push(undefined);this.callArgProps.push(undefined);return this},yieldsOn:function(context){if(typeof context!="object"){throw new TypeError("argument context is not an object")}this.callArgAts.push(-1);this.callbackArguments.push(slice.call(arguments,1));this.callbackContexts.push(context);this.callArgProps.push(undefined);return this},yieldsTo:function(prop){this.callArgAts.push(-1);this.callbackArguments.push(slice.call(arguments,1));this.callbackContexts.push(undefined);this.callArgProps.push(prop);return this},yieldsToOn:function(prop,context){if(typeof context!="object"){throw new TypeError("argument context is not an object")}this.callArgAts.push(-1);this.callbackArguments.push(slice.call(arguments,2));this.callbackContexts.push(context);this.callArgProps.push(prop);return this}};for(var method in proto){if(proto.hasOwnProperty(method)&&method.match(/^(callsArg|yields|thenYields$)/)&&!method.match(/Async/)){proto[method+"Async"]=function(syncFnName){return function(){this.callbackAsync=true;return this[syncFnName].apply(this,arguments)}}(method)}}return proto}());if(commonJSModule){module.exports=stub}else{sinon.stub=stub}})(typeof sinon=="object"&&sinon||null);(function(sinon){var commonJSModule=typeof module=="object"&&typeof require=="function";var push=[].push;if(!sinon&&commonJSModule){sinon=require("../sinon")}if(!sinon){return}function mock(object){if(!object){return sinon.expectation.create("Anonymous mock")}return mock.create(object)}sinon.mock=mock;sinon.extend(mock,function(){function each(collection,callback){if(!collection){return}for(var i=0,l=collection.length;i<l;i+=1){callback(collection[i])}}return{create:function create(object){if(!object){throw new TypeError("object is null")}var mockObject=sinon.extend({},mock);mockObject.object=object;delete mockObject.create;return mockObject},expects:function expects(method){if(!method){throw new TypeError("method is falsy")}if(!this.expectations){this.expectations={};this.proxies=[]}if(!this.expectations[method]){this.expectations[method]=[];var mockObject=this;sinon.wrapMethod(this.object,method,function(){return mockObject.invokeMethod(method,this,arguments)});push.call(this.proxies,method)}var expectation=sinon.expectation.create(method);push.call(this.expectations[method],expectation);return expectation},restore:function restore(){var object=this.object;each(this.proxies,function(proxy){if(typeof object[proxy].restore=="function"){object[proxy].restore()}})},verify:function verify(){var expectations=this.expectations||{};var messages=[],met=[];each(this.proxies,function(proxy){each(expectations[proxy],function(expectation){if(!expectation.met()){push.call(messages,expectation.toString())}else{push.call(met,expectation.toString())}})});this.restore();if(messages.length>0){sinon.expectation.fail(messages.concat(met).join("\n"))}else{sinon.expectation.pass(messages.concat(met).join("\n"))}return true},invokeMethod:function invokeMethod(method,thisValue,args){var expectations=this.expectations&&this.expectations[method];var length=expectations&&expectations.length||0,i;for(i=0;i<length;i+=1){if(!expectations[i].met()&&expectations[i].allowsCall(thisValue,args)){return expectations[i].apply(thisValue,args)}}var messages=[],available,exhausted=0;for(i=0;i<length;i+=1){if(expectations[i].allowsCall(thisValue,args)){available=available||expectations[i]}else{exhausted+=1}push.call(messages,"    "+expectations[i].toString())}if(exhausted===0){return available.apply(thisValue,args)}messages.unshift("Unexpected call: "+sinon.spyCall.toString.call({proxy:method,args:args}));sinon.expectation.fail(messages.join("\n"))}}}());var times=sinon.timesInWords;sinon.expectation=function(){var slice=Array.prototype.slice;var _invoke=sinon.spy.invoke;function callCountInWords(callCount){if(callCount==0){return"never called"}else{return"called "+times(callCount)}}function expectedCallCountInWords(expectation){var min=expectation.minCalls;var max=expectation.maxCalls;if(typeof min=="number"&&typeof max=="number"){var str=times(min);if(min!=max){str="at least "+str+" and at most "+times(max)}return str}if(typeof min=="number"){return"at least "+times(min)}return"at most "+times(max)}function receivedMinCalls(expectation){var hasMinLimit=typeof expectation.minCalls=="number";return!hasMinLimit||expectation.callCount>=expectation.minCalls}function receivedMaxCalls(expectation){if(typeof expectation.maxCalls!="number"){return false}return expectation.callCount==expectation.maxCalls}return{minCalls:1,maxCalls:1,create:function create(methodName){var expectation=sinon.extend(sinon.stub.create(),sinon.expectation);delete expectation.create;expectation.method=methodName;return expectation},invoke:function invoke(func,thisValue,args){this.verifyCallAllowed(thisValue,args);return _invoke.apply(this,arguments)},atLeast:function atLeast(num){if(typeof num!="number"){throw new TypeError("'"+num+"' is not number")}if(!this.limitsSet){this.maxCalls=null;this.limitsSet=true}this.minCalls=num;return this},atMost:function atMost(num){if(typeof num!="number"){throw new TypeError("'"+num+"' is not number")}if(!this.limitsSet){this.minCalls=null;
this.limitsSet=true}this.maxCalls=num;return this},never:function never(){return this.exactly(0)},once:function once(){return this.exactly(1)},twice:function twice(){return this.exactly(2)},thrice:function thrice(){return this.exactly(3)},exactly:function exactly(num){if(typeof num!="number"){throw new TypeError("'"+num+"' is not a number")}this.atLeast(num);return this.atMost(num)},met:function met(){return!this.failed&&receivedMinCalls(this)},verifyCallAllowed:function verifyCallAllowed(thisValue,args){if(receivedMaxCalls(this)){this.failed=true;sinon.expectation.fail(this.method+" already called "+times(this.maxCalls))}if("expectedThis"in this&&this.expectedThis!==thisValue){sinon.expectation.fail(this.method+" called with "+thisValue+" as thisValue, expected "+this.expectedThis)}if(!("expectedArguments"in this)){return}if(!args){sinon.expectation.fail(this.method+" received no arguments, expected "+sinon.format(this.expectedArguments))}if(args.length<this.expectedArguments.length){sinon.expectation.fail(this.method+" received too few arguments ("+sinon.format(args)+"), expected "+sinon.format(this.expectedArguments))}if(this.expectsExactArgCount&&args.length!=this.expectedArguments.length){sinon.expectation.fail(this.method+" received too many arguments ("+sinon.format(args)+"), expected "+sinon.format(this.expectedArguments))}for(var i=0,l=this.expectedArguments.length;i<l;i+=1){if(!sinon.deepEqual(this.expectedArguments[i],args[i])){sinon.expectation.fail(this.method+" received wrong arguments "+sinon.format(args)+", expected "+sinon.format(this.expectedArguments))}}},allowsCall:function allowsCall(thisValue,args){if(this.met()&&receivedMaxCalls(this)){return false}if("expectedThis"in this&&this.expectedThis!==thisValue){return false}if(!("expectedArguments"in this)){return true}args=args||[];if(args.length<this.expectedArguments.length){return false}if(this.expectsExactArgCount&&args.length!=this.expectedArguments.length){return false}for(var i=0,l=this.expectedArguments.length;i<l;i+=1){if(!sinon.deepEqual(this.expectedArguments[i],args[i])){return false}}return true},withArgs:function withArgs(){this.expectedArguments=slice.call(arguments);return this},withExactArgs:function withExactArgs(){this.withArgs.apply(this,arguments);this.expectsExactArgCount=true;return this},on:function on(thisValue){this.expectedThis=thisValue;return this},toString:function(){var args=(this.expectedArguments||[]).slice();if(!this.expectsExactArgCount){push.call(args,"[...]")}var callStr=sinon.spyCall.toString.call({proxy:this.method,args:args});var message=callStr.replace(", [...","[, ...")+" "+expectedCallCountInWords(this);if(this.met()){return"Expectation met: "+message}return"Expected "+message+" ("+callCountInWords(this.callCount)+")"},verify:function verify(){if(!this.met()){sinon.expectation.fail(this.toString())}else{sinon.expectation.pass(this.toString())}return true},pass:function(message){sinon.assert.pass(message)},fail:function(message){var exception=new Error(message);exception.name="ExpectationError";throw exception}}}();if(commonJSModule){module.exports=mock}else{sinon.mock=mock}})(typeof sinon=="object"&&sinon||null);(function(sinon){var commonJSModule=typeof module=="object"&&typeof require=="function";var push=[].push;var hasOwnProperty=Object.prototype.hasOwnProperty;if(!sinon&&commonJSModule){sinon=require("../sinon")}if(!sinon){return}function getFakes(fakeCollection){if(!fakeCollection.fakes){fakeCollection.fakes=[]}return fakeCollection.fakes}function each(fakeCollection,method){var fakes=getFakes(fakeCollection);for(var i=0,l=fakes.length;i<l;i+=1){if(typeof fakes[i][method]=="function"){fakes[i][method]()}}}function compact(fakeCollection){var fakes=getFakes(fakeCollection);var i=0;while(i<fakes.length){fakes.splice(i,1)}}var collection={verify:function resolve(){each(this,"verify")},restore:function restore(){each(this,"restore");compact(this)},verifyAndRestore:function verifyAndRestore(){var exception;try{this.verify()}catch(e){exception=e}this.restore();if(exception){throw exception}},add:function add(fake){push.call(getFakes(this),fake);return fake},spy:function spy(){return this.add(sinon.spy.apply(sinon,arguments))},stub:function stub(object,property,value){if(property){var original=object[property];if(typeof original!="function"){if(!hasOwnProperty.call(object,property)){throw new TypeError("Cannot stub non-existent own property "+property)}object[property]=value;return this.add({restore:function(){object[property]=original}})}}if(!property&&!!object&&typeof object=="object"){var stubbedObj=sinon.stub.apply(sinon,arguments);for(var prop in stubbedObj){if(typeof stubbedObj[prop]==="function"){this.add(stubbedObj[prop])}}return stubbedObj}return this.add(sinon.stub.apply(sinon,arguments))},mock:function mock(){return this.add(sinon.mock.apply(sinon,arguments))},inject:function inject(obj){var col=this;obj.spy=function(){return col.spy.apply(col,arguments)};obj.stub=function(){return col.stub.apply(col,arguments)};obj.mock=function(){return col.mock.apply(col,arguments)};return obj}};if(commonJSModule){module.exports=collection}else{sinon.collection=collection}})(typeof sinon=="object"&&sinon||null);if(typeof sinon=="undefined"){var sinon={}}(function(global){var id=1;function addTimer(args,recurring){if(args.length===0){throw new Error("Function requires at least 1 parameter")}var toId=id++;var delay=args[1]||0;if(!this.timeouts){this.timeouts={}}this.timeouts[toId]={id:toId,func:args[0],callAt:this.now+delay,invokeArgs:Array.prototype.slice.call(args,2)};if(recurring===true){this.timeouts[toId].interval=delay}return toId}function parseTime(str){if(!str){return 0}var strings=str.split(":");var l=strings.length,i=l;var ms=0,parsed;if(l>3||!/^(\d\d:){0,2}\d\d?$/.test(str)){throw new Error("tick only understands numbers and 'h:m:s'")}while(i--){parsed=parseInt(strings[i],10);if(parsed>=60){throw new Error("Invalid time "+str)}ms+=parsed*Math.pow(60,l-i-1)}return ms*1e3}function createObject(object){var newObject;if(Object.create){newObject=Object.create(object)}else{var F=function(){};F.prototype=object;newObject=new F}newObject.Date.clock=newObject;return newObject}sinon.clock={now:0,create:function create(now){var clock=createObject(this);if(typeof now=="number"){clock.now=now}if(!!now&&typeof now=="object"){throw new TypeError("now should be milliseconds since UNIX epoch")}return clock},setTimeout:function setTimeout(callback,timeout){return addTimer.call(this,arguments,false)},clearTimeout:function clearTimeout(timerId){if(!this.timeouts){this.timeouts=[]}if(timerId in this.timeouts){delete this.timeouts[timerId]}},setInterval:function setInterval(callback,timeout){return addTimer.call(this,arguments,true)},clearInterval:function clearInterval(timerId){this.clearTimeout(timerId)},tick:function tick(ms){ms=typeof ms=="number"?ms:parseTime(ms);var tickFrom=this.now,tickTo=this.now+ms,previous=this.now;var timer=this.firstTimerInRange(tickFrom,tickTo);var firstException;while(timer&&tickFrom<=tickTo){if(this.timeouts[timer.id]){tickFrom=this.now=timer.callAt;try{this.callTimer(timer)}catch(e){firstException=firstException||e}}timer=this.firstTimerInRange(previous,tickTo);previous=tickFrom}this.now=tickTo;if(firstException){throw firstException}},firstTimerInRange:function(from,to){var timer,smallest,originalTimer;for(var id in this.timeouts){if(this.timeouts.hasOwnProperty(id)){if(this.timeouts[id].callAt<from||this.timeouts[id].callAt>to){continue}if(!smallest||this.timeouts[id].callAt<smallest){originalTimer=this.timeouts[id];smallest=this.timeouts[id].callAt;timer={func:this.timeouts[id].func,callAt:this.timeouts[id].callAt,interval:this.timeouts[id].interval,id:this.timeouts[id].id,invokeArgs:this.timeouts[id].invokeArgs}}}}return timer||null},callTimer:function(timer){if(typeof timer.interval=="number"){this.timeouts[timer.id].callAt+=timer.interval}else{delete this.timeouts[timer.id]}try{if(typeof timer.func=="function"){timer.func.apply(null,timer.invokeArgs)}else{eval(timer.func)}}catch(e){var exception=e}if(!this.timeouts[timer.id]){if(exception){throw exception}return}if(exception){throw exception}},reset:function reset(){this.timeouts={}},Date:function(){var NativeDate=Date;function ClockDate(year,month,date,hour,minute,second,ms){switch(arguments.length){case 0:return new NativeDate(ClockDate.clock.now);case 1:return new NativeDate(year);case 2:return new NativeDate(year,month);case 3:return new NativeDate(year,month,date);case 4:return new NativeDate(year,month,date,hour);case 5:return new NativeDate(year,month,date,hour,minute);case 6:return new NativeDate(year,month,date,hour,minute,second);default:return new NativeDate(year,month,date,hour,minute,second,ms)}}return mirrorDateProperties(ClockDate,NativeDate)}()};function mirrorDateProperties(target,source){if(source.now){target.now=function now(){return target.clock.now}}else{delete target.now}if(source.toSource){target.toSource=function toSource(){return source.toSource()}}else{delete target.toSource}target.toString=function toString(){return source.toString()};target.prototype=source.prototype;target.parse=source.parse;target.UTC=source.UTC;target.prototype.toUTCString=source.prototype.toUTCString;return target}var methods=["Date","setTimeout","setInterval","clearTimeout","clearInterval"];function restore(){var method;for(var i=0,l=this.methods.length;i<l;i++){method=this.methods[i];if(global[method].hadOwnProperty){global[method]=this["_"+method]}else{delete global[method]}}this.methods=[]}function stubGlobal(method,clock){clock[method].hadOwnProperty=Object.prototype.hasOwnProperty.call(global,method);clock["_"+method]=global[method];if(method=="Date"){var date=mirrorDateProperties(clock[method],global[method]);global[method]=date}else{global[method]=function(){return clock[method].apply(clock,arguments)};for(var prop in clock[method]){if(clock[method].hasOwnProperty(prop)){global[method][prop]=clock[method][prop]}}}global[method].clock=clock}sinon.useFakeTimers=function useFakeTimers(now){var clock=sinon.clock.create(now);clock.restore=restore;clock.methods=Array.prototype.slice.call(arguments,typeof now=="number"?1:0);if(clock.methods.length===0){clock.methods=methods}for(var i=0,l=clock.methods.length;i<l;i++){stubGlobal(clock.methods[i],clock)}return clock}})(typeof global!="undefined"&&typeof global!=="function"?global:this);sinon.timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setInterval:setInterval,clearInterval:clearInterval,Date:Date};if(typeof module=="object"&&typeof require=="function"){module.exports=sinon}if(typeof sinon=="undefined"){this.sinon={}}(function(){var push=[].push;sinon.Event=function Event(type,bubbles,cancelable){this.initEvent(type,bubbles,cancelable)};sinon.Event.prototype={initEvent:function(type,bubbles,cancelable){this.type=type;this.bubbles=bubbles;this.cancelable=cancelable},stopPropagation:function(){},preventDefault:function(){this.defaultPrevented=true}};sinon.EventTarget={addEventListener:function addEventListener(event,listener,useCapture){this.eventListeners=this.eventListeners||{};this.eventListeners[event]=this.eventListeners[event]||[];push.call(this.eventListeners[event],listener)},removeEventListener:function removeEventListener(event,listener,useCapture){var listeners=this.eventListeners&&this.eventListeners[event]||[];for(var i=0,l=listeners.length;i<l;++i){if(listeners[i]==listener){return listeners.splice(i,1)}}},dispatchEvent:function dispatchEvent(event){var type=event.type;var listeners=this.eventListeners&&this.eventListeners[type]||[];for(var i=0;i<listeners.length;i++){if(typeof listeners[i]=="function"){listeners[i].call(this,event)}else{listeners[i].handleEvent(event)}}return!!event.defaultPrevented}}})();if(typeof sinon=="undefined"){this.sinon={}}sinon.xhr={XMLHttpRequest:this.XMLHttpRequest};(function(global){var xhr=sinon.xhr;xhr.GlobalXMLHttpRequest=global.XMLHttpRequest;xhr.GlobalActiveXObject=global.ActiveXObject;xhr.supportsActiveX=typeof xhr.GlobalActiveXObject!="undefined";xhr.supportsXHR=typeof xhr.GlobalXMLHttpRequest!="undefined";xhr.workingXHR=xhr.supportsXHR?xhr.GlobalXMLHttpRequest:xhr.supportsActiveX?function(){return new xhr.GlobalActiveXObject("MSXML2.XMLHTTP.3.0")}:false;var unsafeHeaders={"Accept-Charset":true,"Accept-Encoding":true,Connection:true,"Content-Length":true,Cookie:true,Cookie2:true,"Content-Transfer-Encoding":true,Date:true,Expect:true,Host:true,"Keep-Alive":true,Referer:true,TE:true,Trailer:true,"Transfer-Encoding":true,Upgrade:true,"User-Agent":true,Via:true};function FakeXMLHttpRequest(){this.readyState=FakeXMLHttpRequest.UNSENT;this.requestHeaders={};this.requestBody=null;this.status=0;this.statusText="";if(typeof FakeXMLHttpRequest.onCreate=="function"){FakeXMLHttpRequest.onCreate(this)}}function verifyState(xhr){if(xhr.readyState!==FakeXMLHttpRequest.OPENED){throw new Error("INVALID_STATE_ERR")}if(xhr.sendFlag){throw new Error("INVALID_STATE_ERR")}}function each(collection,callback){if(!collection)return;for(var i=0,l=collection.length;i<l;i+=1){callback(collection[i])}}function some(collection,callback){for(var index=0;index<collection.length;index++){if(callback(collection[index])===true)return true}return false}var apply=function(obj,method,args){switch(args.length){case 0:return obj[method]();case 1:return obj[method](args[0]);case 2:return obj[method](args[0],args[1]);case 3:return obj[method](args[0],args[1],args[2]);case 4:return obj[method](args[0],args[1],args[2],args[3]);case 5:return obj[method](args[0],args[1],args[2],args[3],args[4])}};FakeXMLHttpRequest.filters=[];FakeXMLHttpRequest.addFilter=function(fn){this.filters.push(fn)};var IE6Re=/MSIE 6/;FakeXMLHttpRequest.defake=function(fakeXhr,xhrArgs){var xhr=new sinon.xhr.workingXHR;each(["open","setRequestHeader","send","abort","getResponseHeader","getAllResponseHeaders","addEventListener","overrideMimeType","removeEventListener"],function(method){fakeXhr[method]=function(){return apply(xhr,method,arguments)}});var copyAttrs=function(args){each(args,function(attr){try{fakeXhr[attr]=xhr[attr]}catch(e){if(!IE6Re.test(navigator.userAgent))throw e}})};var stateChange=function(){fakeXhr.readyState=xhr.readyState;if(xhr.readyState>=FakeXMLHttpRequest.HEADERS_RECEIVED){copyAttrs(["status","statusText"])}if(xhr.readyState>=FakeXMLHttpRequest.LOADING){copyAttrs(["responseText"])}if(xhr.readyState===FakeXMLHttpRequest.DONE){copyAttrs(["responseXML"])}if(fakeXhr.onreadystatechange)fakeXhr.onreadystatechange.call(fakeXhr)};if(xhr.addEventListener){for(var event in fakeXhr.eventListeners){if(fakeXhr.eventListeners.hasOwnProperty(event)){each(fakeXhr.eventListeners[event],function(handler){xhr.addEventListener(event,handler)})}}xhr.addEventListener("readystatechange",stateChange)}else{xhr.onreadystatechange=stateChange}apply(xhr,"open",xhrArgs)};FakeXMLHttpRequest.useFilters=false;function verifyRequestSent(xhr){if(xhr.readyState==FakeXMLHttpRequest.DONE){throw new Error("Request done")}}function verifyHeadersReceived(xhr){if(xhr.async&&xhr.readyState!=FakeXMLHttpRequest.HEADERS_RECEIVED){throw new Error("No headers received")}}function verifyResponseBodyType(body){if(typeof body!="string"){var error=new Error("Attempted to respond to fake XMLHttpRequest with "+body+", which is not a string.");error.name="InvalidBodyException";throw error}}sinon.extend(FakeXMLHttpRequest.prototype,sinon.EventTarget,{async:true,open:function open(method,url,async,username,password){this.method=method;this.url=url;this.async=typeof async=="boolean"?async:true;this.username=username;this.password=password;this.responseText=null;this.responseXML=null;this.requestHeaders={};this.sendFlag=false;if(sinon.FakeXMLHttpRequest.useFilters===true){var xhrArgs=arguments;var defake=some(FakeXMLHttpRequest.filters,function(filter){return filter.apply(this,xhrArgs)});if(defake){return sinon.FakeXMLHttpRequest.defake(this,arguments)}}this.readyStateChange(FakeXMLHttpRequest.OPENED)},readyStateChange:function readyStateChange(state){this.readyState=state;if(typeof this.onreadystatechange=="function"){try{this.onreadystatechange()}catch(e){sinon.logError("Fake XHR onreadystatechange handler",e)}}this.dispatchEvent(new sinon.Event("readystatechange"))},setRequestHeader:function setRequestHeader(header,value){verifyState(this);if(unsafeHeaders[header]||/^(Sec-|Proxy-)/.test(header)){throw new Error('Refused to set unsafe header "'+header+'"')}if(this.requestHeaders[header]){this.requestHeaders[header]+=","+value}else{this.requestHeaders[header]=value}},setResponseHeaders:function setResponseHeaders(headers){this.responseHeaders={};for(var header in headers){if(headers.hasOwnProperty(header)){this.responseHeaders[header]=headers[header]}}if(this.async){this.readyStateChange(FakeXMLHttpRequest.HEADERS_RECEIVED)}},send:function send(data){verifyState(this);if(!/^(get|head)$/i.test(this.method)){if(this.requestHeaders["Content-Type"]){var value=this.requestHeaders["Content-Type"].split(";");this.requestHeaders["Content-Type"]=value[0]+";charset=utf-8"}else{this.requestHeaders["Content-Type"]="text/plain;charset=utf-8"}this.requestBody=data}this.errorFlag=false;this.sendFlag=this.async;this.readyStateChange(FakeXMLHttpRequest.OPENED);if(typeof this.onSend=="function"){this.onSend(this)}},abort:function abort(){this.aborted=true;this.responseText=null;this.errorFlag=true;this.requestHeaders={};if(this.readyState>sinon.FakeXMLHttpRequest.UNSENT&&this.sendFlag){this.readyStateChange(sinon.FakeXMLHttpRequest.DONE);this.sendFlag=false}this.readyState=sinon.FakeXMLHttpRequest.UNSENT},getResponseHeader:function getResponseHeader(header){if(this.readyState<FakeXMLHttpRequest.HEADERS_RECEIVED){return null}if(/^Set-Cookie2?$/i.test(header)){return null}header=header.toLowerCase();for(var h in this.responseHeaders){if(h.toLowerCase()==header){return this.responseHeaders[h]}}return null},getAllResponseHeaders:function getAllResponseHeaders(){if(this.readyState<FakeXMLHttpRequest.HEADERS_RECEIVED){return""}var headers="";for(var header in this.responseHeaders){if(this.responseHeaders.hasOwnProperty(header)&&!/^Set-Cookie2?$/i.test(header)){headers+=header+": "+this.responseHeaders[header]+"\r\n"}}return headers},setResponseBody:function setResponseBody(body){verifyRequestSent(this);verifyHeadersReceived(this);verifyResponseBodyType(body);var chunkSize=this.chunkSize||10;var index=0;this.responseText="";do{if(this.async){this.readyStateChange(FakeXMLHttpRequest.LOADING)}this.responseText+=body.substring(index,index+chunkSize);index+=chunkSize}while(index<body.length);var type=this.getResponseHeader("Content-Type");if(this.responseText&&(!type||/(text\/xml)|(application\/xml)|(\+xml)/.test(type))){try{this.responseXML=FakeXMLHttpRequest.parseXML(this.responseText)}catch(e){}}if(this.async){this.readyStateChange(FakeXMLHttpRequest.DONE)}else{this.readyState=FakeXMLHttpRequest.DONE}},respond:function respond(status,headers,body){this.setResponseHeaders(headers||{});this.status=typeof status=="number"?status:200;this.statusText=FakeXMLHttpRequest.statusCodes[this.status];this.setResponseBody(body||"")}});sinon.extend(FakeXMLHttpRequest,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4});FakeXMLHttpRequest.parseXML=function parseXML(text){var xmlDoc;if(typeof DOMParser!="undefined"){var parser=new DOMParser;xmlDoc=parser.parseFromString(text,"text/xml")}else{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(text)}return xmlDoc};FakeXMLHttpRequest.statusCodes={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"};sinon.useFakeXMLHttpRequest=function(){sinon.FakeXMLHttpRequest.restore=function restore(keepOnCreate){if(xhr.supportsXHR){global.XMLHttpRequest=xhr.GlobalXMLHttpRequest}if(xhr.supportsActiveX){global.ActiveXObject=xhr.GlobalActiveXObject}delete sinon.FakeXMLHttpRequest.restore;if(keepOnCreate!==true){delete sinon.FakeXMLHttpRequest.onCreate}};if(xhr.supportsXHR){global.XMLHttpRequest=sinon.FakeXMLHttpRequest}if(xhr.supportsActiveX){global.ActiveXObject=function ActiveXObject(objId){if(objId=="Microsoft.XMLHTTP"||/^Msxml2\.XMLHTTP/i.test(objId)){return new sinon.FakeXMLHttpRequest}return new xhr.GlobalActiveXObject(objId)}}return sinon.FakeXMLHttpRequest};sinon.FakeXMLHttpRequest=FakeXMLHttpRequest})(this);if(typeof module=="object"&&typeof require=="function"){module.exports=sinon}if(typeof sinon=="undefined"){var sinon={}}sinon.fakeServer=function(){var push=[].push;function F(){}function create(proto){F.prototype=proto;return new F}function responseArray(handler){var response=handler;if(Object.prototype.toString.call(handler)!="[object Array]"){response=[200,{},handler]}if(typeof response[2]!="string"){throw new TypeError("Fake server response body should be string, but was "+typeof response[2])}return response}var wloc=typeof window!=="undefined"?window.location:{};var rCurrLoc=new RegExp("^"+wloc.protocol+"//"+wloc.host);function matchOne(response,reqMethod,reqUrl){var rmeth=response.method;var matchMethod=!rmeth||rmeth.toLowerCase()==reqMethod.toLowerCase();var url=response.url;var matchUrl=!url||url==reqUrl||typeof url.test=="function"&&url.test(reqUrl);return matchMethod&&matchUrl}function match(response,request){var requestMethod=this.getHTTPMethod(request);var requestUrl=request.url;if(!/^https?:\/\//.test(requestUrl)||rCurrLoc.test(requestUrl)){requestUrl=requestUrl.replace(rCurrLoc,"")}if(matchOne(response,this.getHTTPMethod(request),requestUrl)){if(typeof response.response=="function"){var ru=response.url;var args=[request].concat(!ru?[]:requestUrl.match(ru).slice(1));return response.response.apply(response,args)}return true}return false}return{create:function(){var server=create(this);this.xhr=sinon.useFakeXMLHttpRequest();server.requests=[];this.xhr.onCreate=function(xhrObj){server.addRequest(xhrObj)};return server},addRequest:function addRequest(xhrObj){var server=this;push.call(this.requests,xhrObj);xhrObj.onSend=function(){server.handleRequest(this)};if(this.autoRespond&&!this.responding){setTimeout(function(){server.responding=false;server.respond()},this.autoRespondAfter||10);this.responding=true}},getHTTPMethod:function getHTTPMethod(request){if(this.fakeHTTPMethods&&/post/i.test(request.method)){var matches=(request.requestBody||"").match(/_method=([^\b;]+)/);return!!matches?matches[1]:request.method}return request.method},handleRequest:function handleRequest(xhr){if(xhr.async){if(!this.queue){this.queue=[]}push.call(this.queue,xhr)}else{this.processRequest(xhr)}},respondWith:function respondWith(method,url,body){if(arguments.length==1&&typeof method!="function"){this.response=responseArray(method);return}if(!this.responses){this.responses=[]}if(arguments.length==1){body=method;url=method=null}if(arguments.length==2){body=url;url=method;method=null}push.call(this.responses,{method:method,url:url,response:typeof body=="function"?body:responseArray(body)})},respond:function respond(){if(arguments.length>0)this.respondWith.apply(this,arguments);var queue=this.queue||[];var request;while(request=queue.shift()){this.processRequest(request)}},processRequest:function processRequest(request){try{if(request.aborted){return}var response=this.response||[404,{},""];if(this.responses){for(var i=0,l=this.responses.length;i<l;i++){if(match.call(this,this.responses[i],request)){response=this.responses[i].response;break}}}if(request.readyState!=4){request.respond(response[0],response[1],response[2])}}catch(e){sinon.logError("Fake server request processing",e)}},restore:function restore(){return this.xhr.restore&&this.xhr.restore.apply(this.xhr,arguments)}}}();if(typeof module=="object"&&typeof require=="function"){module.exports=sinon}(function(){function Server(){}Server.prototype=sinon.fakeServer;sinon.fakeServerWithClock=new Server;sinon.fakeServerWithClock.addRequest=function addRequest(xhr){if(xhr.async){if(typeof setTimeout.clock=="object"){this.clock=setTimeout.clock}else{this.clock=sinon.useFakeTimers();this.resetClock=true}if(!this.longestTimeout){var clockSetTimeout=this.clock.setTimeout;var clockSetInterval=this.clock.setInterval;var server=this;this.clock.setTimeout=function(fn,timeout){server.longestTimeout=Math.max(timeout,server.longestTimeout||0);return clockSetTimeout.apply(this,arguments)};this.clock.setInterval=function(fn,timeout){server.longestTimeout=Math.max(timeout,server.longestTimeout||0);return clockSetInterval.apply(this,arguments)}}}return sinon.fakeServer.addRequest.call(this,xhr)};sinon.fakeServerWithClock.respond=function respond(){var returnVal=sinon.fakeServer.respond.apply(this,arguments);if(this.clock){this.clock.tick(this.longestTimeout||0);this.longestTimeout=0;if(this.resetClock){this.clock.restore();this.resetClock=false}}return returnVal};sinon.fakeServerWithClock.restore=function restore(){if(this.clock){this.clock.restore()}return sinon.fakeServer.restore.apply(this,arguments)}})();if(typeof module=="object"&&typeof require=="function"){var sinon=require("../sinon");sinon.extend(sinon,require("./util/fake_timers"))}(function(){var push=[].push;function exposeValue(sandbox,config,key,value){if(!value){return}if(config.injectInto){config.injectInto[key]=value}else{push.call(sandbox.args,value)}}function prepareSandboxFromConfig(config){var sandbox=sinon.create(sinon.sandbox);if(config.useFakeServer){if(typeof config.useFakeServer=="object"){sandbox.serverPrototype=config.useFakeServer}sandbox.useFakeServer()}if(config.useFakeTimers){if(typeof config.useFakeTimers=="object"){sandbox.useFakeTimers.apply(sandbox,config.useFakeTimers)}else{sandbox.useFakeTimers()}}return sandbox}sinon.sandbox=sinon.extend(sinon.create(sinon.collection),{useFakeTimers:function useFakeTimers(){this.clock=sinon.useFakeTimers.apply(sinon,arguments);return this.add(this.clock)},serverPrototype:sinon.fakeServer,useFakeServer:function useFakeServer(){var proto=this.serverPrototype||sinon.fakeServer;if(!proto||!proto.create){return null}this.server=proto.create();return this.add(this.server)},inject:function(obj){sinon.collection.inject.call(this,obj);if(this.clock){obj.clock=this.clock}if(this.server){obj.server=this.server;obj.requests=this.server.requests}return obj},create:function(config){if(!config){return sinon.create(sinon.sandbox)}var sandbox=prepareSandboxFromConfig(config);sandbox.args=sandbox.args||[];var prop,value,exposed=sandbox.inject({});if(config.properties){for(var i=0,l=config.properties.length;i<l;i++){prop=config.properties[i];value=exposed[prop]||prop=="sandbox"&&sandbox;exposeValue(sandbox,config,prop,value)}}else{exposeValue(sandbox,config,"sandbox",value)}return sandbox}});sinon.sandbox.useFakeXMLHttpRequest=sinon.sandbox.useFakeServer;if(typeof module=="object"&&typeof require=="function"){module.exports=sinon.sandbox}})();(function(sinon){var commonJSModule=typeof module=="object"&&typeof require=="function";if(!sinon&&commonJSModule){sinon=require("../sinon")}if(!sinon){return}function test(callback){var type=typeof callback;if(type!="function"){throw new TypeError("sinon.test needs to wrap a test function, got "+type)}return function(){var config=sinon.getConfig(sinon.config);config.injectInto=config.injectIntoThis&&this||config.injectInto;var sandbox=sinon.sandbox.create(config);var exception,result;var args=Array.prototype.slice.call(arguments).concat(sandbox.args);try{result=callback.apply(this,args)}catch(e){exception=e}if(typeof exception!=="undefined"){sandbox.restore();throw exception}else{sandbox.verifyAndRestore()}return result}}test.config={injectIntoThis:true,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:true,useFakeServer:true};if(commonJSModule){module.exports=test}else{sinon.test=test}})(typeof sinon=="object"&&sinon||null);(function(sinon){var commonJSModule=typeof module=="object"&&typeof require=="function";if(!sinon&&commonJSModule){sinon=require("../sinon")}if(!sinon||!Object.prototype.hasOwnProperty){return}function createTest(property,setUp,tearDown){return function(){if(setUp){setUp.apply(this,arguments)}var exception,result;try{result=property.apply(this,arguments)}catch(e){exception=e}if(tearDown){tearDown.apply(this,arguments)}if(exception){throw exception}return result}}function testCase(tests,prefix){if(!tests||typeof tests!="object"){throw new TypeError("sinon.testCase needs an object with test functions")}prefix=prefix||"test";var rPrefix=new RegExp("^"+prefix);var methods={},testName,property,method;var setUp=tests.setUp;var tearDown=tests.tearDown;for(testName in tests){if(tests.hasOwnProperty(testName)){property=tests[testName];if(/^(setUp|tearDown)$/.test(testName)){continue}if(typeof property=="function"&&rPrefix.test(testName)){method=property;if(setUp||tearDown){method=createTest(property,setUp,tearDown)}methods[testName]=sinon.test(method)}else{methods[testName]=tests[testName]}}}return methods}if(commonJSModule){module.exports=testCase}else{sinon.testCase=testCase}})(typeof sinon=="object"&&sinon||null);(function(sinon,global){var commonJSModule=typeof module=="object"&&typeof require=="function";var slice=Array.prototype.slice;var assert;if(!sinon&&commonJSModule){sinon=require("../sinon")}if(!sinon){return}function verifyIsStub(){var method;for(var i=0,l=arguments.length;i<l;++i){method=arguments[i];if(!method){assert.fail("fake is not a spy")}if(typeof method!="function"){assert.fail(method+" is not a function")}if(typeof method.getCall!="function"){assert.fail(method+" is not stubbed")}}}function failAssertion(object,msg){object=object||global;var failMethod=object.fail||assert.fail;failMethod.call(object,msg)}function mirrorPropAsAssertion(name,method,message){if(arguments.length==2){message=method;method=name}assert[name]=function(fake){verifyIsStub(fake);var args=slice.call(arguments,1);var failed=false;if(typeof method=="function"){failed=!method(fake)}else{failed=typeof fake[method]=="function"?!fake[method].apply(fake,args):!fake[method]}if(failed){failAssertion(this,fake.printf.apply(fake,[message].concat(args)))}else{assert.pass(name)}}}function exposedName(prefix,prop){return!prefix||/^fail/.test(prop)?prop:prefix+prop.slice(0,1).toUpperCase()+prop.slice(1)}assert={failException:"AssertError",fail:function fail(message){var error=new Error(message);error.name=this.failException||assert.failException;throw error},pass:function pass(assertion){},callOrder:function assertCallOrder(){verifyIsStub.apply(null,arguments);var expected="",actual="";if(!sinon.calledInOrder(arguments)){try{expected=[].join.call(arguments,", ");actual=sinon.orderByFirstCall(slice.call(arguments)).join(", ")}catch(e){}failAssertion(this,"expected "+expected+" to be "+"called in order but were called as "+actual)}else{assert.pass("callOrder")}},callCount:function assertCallCount(method,count){verifyIsStub(method);if(method.callCount!=count){var msg="expected %n to be called "+sinon.timesInWords(count)+" but was called %c%C";failAssertion(this,method.printf(msg))}else{assert.pass("callCount")}},expose:function expose(target,options){if(!target){throw new TypeError("target is null or undefined")}var o=options||{};var prefix=typeof o.prefix=="undefined"&&"assert"||o.prefix;
var includeFail=typeof o.includeFail=="undefined"||!!o.includeFail;for(var method in this){if(method!="export"&&(includeFail||!/^(fail)/.test(method))){target[exposedName(prefix,method)]=this[method]}}return target}};mirrorPropAsAssertion("called","expected %n to have been called at least once but was never called");mirrorPropAsAssertion("notCalled",function(spy){return!spy.called},"expected %n to not have been called but was called %c%C");mirrorPropAsAssertion("calledOnce","expected %n to be called once but was called %c%C");mirrorPropAsAssertion("calledTwice","expected %n to be called twice but was called %c%C");mirrorPropAsAssertion("calledThrice","expected %n to be called thrice but was called %c%C");mirrorPropAsAssertion("calledOn","expected %n to be called with %1 as this but was called with %t");mirrorPropAsAssertion("alwaysCalledOn","expected %n to always be called with %1 as this but was called with %t");mirrorPropAsAssertion("calledWithNew","expected %n to be called with new");mirrorPropAsAssertion("alwaysCalledWithNew","expected %n to always be called with new");mirrorPropAsAssertion("calledWith","expected %n to be called with arguments %*%C");mirrorPropAsAssertion("calledWithMatch","expected %n to be called with match %*%C");mirrorPropAsAssertion("alwaysCalledWith","expected %n to always be called with arguments %*%C");mirrorPropAsAssertion("alwaysCalledWithMatch","expected %n to always be called with match %*%C");mirrorPropAsAssertion("calledWithExactly","expected %n to be called with exact arguments %*%C");mirrorPropAsAssertion("alwaysCalledWithExactly","expected %n to always be called with exact arguments %*%C");mirrorPropAsAssertion("neverCalledWith","expected %n to never be called with arguments %*%C");mirrorPropAsAssertion("neverCalledWithMatch","expected %n to never be called with match %*%C");mirrorPropAsAssertion("threw","%n did not throw exception%C");mirrorPropAsAssertion("alwaysThrew","%n did not always throw exception%C");if(commonJSModule){module.exports=assert}else{sinon.assert=assert}})(typeof sinon=="object"&&sinon||null,typeof window!="undefined"?window:global);return sinon}.call(typeof window!="undefined"&&window||{});(function(global,module){if("undefined"==typeof module){var module={exports:{}},exports=module.exports}module.exports=expect;expect.Assertion=Assertion;expect.version="0.1.2";var flags=expect.flags={not:["to","be","have","include","only"],to:["be","have","include","only","not"],only:["have"],have:["own"],be:["an"]};function expect(obj){return new Assertion(obj)}function Assertion(obj,flag,parent){this.obj=obj;this.flags={};if(undefined!=parent){this.flags[flag]=true;for(var i in parent.flags){if(parent.flags.hasOwnProperty(i)){this.flags[i]=true}}}var $flags=flag?flags[flag]:keys(flags),self=this;if($flags){for(var i=0,l=$flags.length;i<l;i++){if(this.flags[$flags[i]])continue;var name=$flags[i],assertion=new Assertion(this.obj,name,this);if("function"==typeof Assertion.prototype[name]){var old=this[name];(function(old){self[name]=function(){return old.apply(self,arguments)}})(old);for(var fn in Assertion.prototype){if(Assertion.prototype.hasOwnProperty(fn)&&fn!=name){this[name][fn]=bind(assertion[fn],assertion)}}for(var fn2 in assertion){if(assertion.hasOwnProperty(fn2)){this[name][fn2]=assertion[fn2]}}}else{this[name]=assertion}}}}Assertion.prototype.assert=function(truth,msg,error){var msg=this.flags.not?error:msg,ok=this.flags.not?!truth:truth;if(!ok){throw new Error(msg.call(this))}this.and=new Assertion(this.obj)};Assertion.prototype.ok=function(){this.assert(!!this.obj,function(){return"expected "+i(this.obj)+" to be truthy"},function(){return"expected "+i(this.obj)+" to be falsy"})};Assertion.prototype.throwError=Assertion.prototype.throwException=function(fn){expect(this.obj).to.be.a("function");var thrown=false,not=this.flags.not;try{this.obj()}catch(e){if("function"==typeof fn){fn(e)}else if("object"==typeof fn){var subject="string"==typeof e?e:e.message;if(not){expect(subject).to.not.match(fn)}else{expect(subject).to.match(fn)}}thrown=true}if("object"==typeof fn&&not){this.flags.not=false}var name=this.obj.name||"fn";this.assert(thrown,function(){return"expected "+name+" to throw an exception"},function(){return"expected "+name+" not to throw an exception"})};Assertion.prototype.empty=function(){var expectation;if("object"==typeof this.obj&&null!==this.obj&&!isArray(this.obj)){if("number"==typeof this.obj.length){expectation=!this.obj.length}else{expectation=!keys(this.obj).length}}else{if("string"!=typeof this.obj){expect(this.obj).to.be.an("object")}expect(this.obj).to.have.property("length");expectation=!this.obj.length}this.assert(expectation,function(){return"expected "+i(this.obj)+" to be empty"},function(){return"expected "+i(this.obj)+" to not be empty"});return this};Assertion.prototype.be=Assertion.prototype.equal=function(obj){this.assert(obj===this.obj,function(){return"expected "+i(this.obj)+" to equal "+i(obj)},function(){return"expected "+i(this.obj)+" to not equal "+i(obj)});return this};Assertion.prototype.eql=function(obj){this.assert(expect.eql(obj,this.obj),function(){return"expected "+i(this.obj)+" to sort of equal "+i(obj)},function(){return"expected "+i(this.obj)+" to sort of not equal "+i(obj)});return this};Assertion.prototype.within=function(start,finish){var range=start+".."+finish;this.assert(this.obj>=start&&this.obj<=finish,function(){return"expected "+i(this.obj)+" to be within "+range},function(){return"expected "+i(this.obj)+" to not be within "+range});return this};Assertion.prototype.a=Assertion.prototype.an=function(type){if("string"==typeof type){var n=/^[aeiou]/.test(type)?"n":"";this.assert("array"==type?isArray(this.obj):"object"==type?"object"==typeof this.obj&&null!==this.obj:type==typeof this.obj,function(){return"expected "+i(this.obj)+" to be a"+n+" "+type},function(){return"expected "+i(this.obj)+" not to be a"+n+" "+type})}else{var name=type.name||"supplied constructor";this.assert(this.obj instanceof type,function(){return"expected "+i(this.obj)+" to be an instance of "+name},function(){return"expected "+i(this.obj)+" not to be an instance of "+name})}return this};Assertion.prototype.greaterThan=Assertion.prototype.above=function(n){this.assert(this.obj>n,function(){return"expected "+i(this.obj)+" to be above "+n},function(){return"expected "+i(this.obj)+" to be below "+n});return this};Assertion.prototype.lessThan=Assertion.prototype.below=function(n){this.assert(this.obj<n,function(){return"expected "+i(this.obj)+" to be below "+n},function(){return"expected "+i(this.obj)+" to be above "+n});return this};Assertion.prototype.match=function(regexp){this.assert(regexp.exec(this.obj),function(){return"expected "+i(this.obj)+" to match "+regexp},function(){return"expected "+i(this.obj)+" not to match "+regexp});return this};Assertion.prototype.length=function(n){expect(this.obj).to.have.property("length");var len=this.obj.length;this.assert(n==len,function(){return"expected "+i(this.obj)+" to have a length of "+n+" but got "+len},function(){return"expected "+i(this.obj)+" to not have a length of "+len});return this};Assertion.prototype.property=function(name,val){if(this.flags.own){this.assert(Object.prototype.hasOwnProperty.call(this.obj,name),function(){return"expected "+i(this.obj)+" to have own property "+i(name)},function(){return"expected "+i(this.obj)+" to not have own property "+i(name)});return this}if(this.flags.not&&undefined!==val){if(undefined===this.obj[name]){throw new Error(i(this.obj)+" has no property "+i(name))}}else{var hasProp;try{hasProp=name in this.obj}catch(e){hasProp=undefined!==this.obj[name]}this.assert(hasProp,function(){return"expected "+i(this.obj)+" to have a property "+i(name)},function(){return"expected "+i(this.obj)+" to not have a property "+i(name)})}if(undefined!==val){this.assert(val===this.obj[name],function(){return"expected "+i(this.obj)+" to have a property "+i(name)+" of "+i(val)+", but got "+i(this.obj[name])},function(){return"expected "+i(this.obj)+" to not have a property "+i(name)+" of "+i(val)})}this.obj=this.obj[name];return this};Assertion.prototype.string=Assertion.prototype.contain=function(obj){if("string"==typeof this.obj){this.assert(~this.obj.indexOf(obj),function(){return"expected "+i(this.obj)+" to contain "+i(obj)},function(){return"expected "+i(this.obj)+" to not contain "+i(obj)})}else{this.assert(~indexOf(this.obj,obj),function(){return"expected "+i(this.obj)+" to contain "+i(obj)},function(){return"expected "+i(this.obj)+" to not contain "+i(obj)})}return this};Assertion.prototype.key=Assertion.prototype.keys=function($keys){var str,ok=true;$keys=isArray($keys)?$keys:Array.prototype.slice.call(arguments);if(!$keys.length)throw new Error("keys required");var actual=keys(this.obj),len=$keys.length;ok=every($keys,function(key){return~indexOf(actual,key)});if(!this.flags.not&&this.flags.only){ok=ok&&$keys.length==actual.length}if(len>1){$keys=map($keys,function(key){return i(key)});var last=$keys.pop();str=$keys.join(", ")+", and "+last}else{str=i($keys[0])}str=(len>1?"keys ":"key ")+str;str=(!this.flags.only?"include ":"only have ")+str;this.assert(ok,function(){return"expected "+i(this.obj)+" to "+str},function(){return"expected "+i(this.obj)+" to not "+str});return this};Assertion.prototype.fail=function(msg){msg=msg||"explicit failure";this.assert(false,msg,msg);return this};function bind(fn,scope){return function(){return fn.apply(scope,arguments)}}function every(arr,fn,thisObj){var scope=thisObj||global;for(var i=0,j=arr.length;i<j;++i){if(!fn.call(scope,arr[i],i,arr)){return false}}return true}function indexOf(arr,o,i){if(Array.prototype.indexOf){return Array.prototype.indexOf.call(arr,o,i)}if(arr.length===undefined){return-1}for(var j=arr.length,i=i<0?i+j<0?0:i+j:i||0;i<j&&arr[i]!==o;i++);return j<=i?-1:i}var getOuterHTML=function(element){if("outerHTML"in element)return element.outerHTML;var ns="http://www.w3.org/1999/xhtml";var container=document.createElementNS(ns,"_");var elemProto=(window.HTMLElement||window.Element).prototype;var xmlSerializer=new XMLSerializer;var html;if(document.xmlVersion){return xmlSerializer.serializeToString(element)}else{container.appendChild(element.cloneNode(false));html=container.innerHTML.replace("><",">"+element.innerHTML+"<");container.innerHTML="";return html}};var isDOMElement=function(object){if(typeof HTMLElement==="object"){return object instanceof HTMLElement}else{return object&&typeof object==="object"&&object.nodeType===1&&typeof object.nodeName==="string"}};function i(obj,showHidden,depth){var seen=[];function stylize(str){return str}function format(value,recurseTimes){if(value&&typeof value.inspect==="function"&&value!==exports&&!(value.constructor&&value.constructor.prototype===value)){return value.inspect(recurseTimes)}switch(typeof value){case"undefined":return stylize("undefined","undefined");case"string":var simple="'"+json.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return stylize(simple,"string");case"number":return stylize(""+value,"number");case"boolean":return stylize(""+value,"boolean")}if(value===null){return stylize("null","null")}if(isDOMElement(value)){return getOuterHTML(value)}var visible_keys=keys(value);var $keys=showHidden?Object.getOwnPropertyNames(value):visible_keys;if(typeof value==="function"&&$keys.length===0){if(isRegExp(value)){return stylize(""+value,"regexp")}else{var name=value.name?": "+value.name:"";return stylize("[Function"+name+"]","special")}}if(isDate(value)&&$keys.length===0){return stylize(value.toUTCString(),"date")}var base,type,braces;if(isArray(value)){type="Array";braces=["[","]"]}else{type="Object";braces=["{","}"]}if(typeof value==="function"){var n=value.name?": "+value.name:"";base=isRegExp(value)?" "+value:" [Function"+n+"]"}else{base=""}if(isDate(value)){base=" "+value.toUTCString()}if($keys.length===0){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return stylize(""+value,"regexp")}else{return stylize("[Object]","special")}}seen.push(value);var output=map($keys,function(key){var name,str;if(value.__lookupGetter__){if(value.__lookupGetter__(key)){if(value.__lookupSetter__(key)){str=stylize("[Getter/Setter]","special")}else{str=stylize("[Getter]","special")}}else{if(value.__lookupSetter__(key)){str=stylize("[Setter]","special")}}}if(indexOf(visible_keys,key)<0){name="["+key+"]"}if(!str){if(indexOf(seen,value[key])<0){if(recurseTimes===null){str=format(value[key])}else{str=format(value[key],recurseTimes-1)}if(str.indexOf("\n")>-1){if(isArray(value)){str=map(str.split("\n"),function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+map(str.split("\n"),function(line){return"   "+line}).join("\n")}}}else{str=stylize("[Circular]","special")}}if(typeof name==="undefined"){if(type==="Array"&&key.match(/^\d+$/)){return str}name=json.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=stylize(name,"string")}}return name+": "+str});seen.pop();var numLinesEst=0;var length=reduce(output,function(prev,cur){numLinesEst++;if(indexOf(cur,"\n")>=0)numLinesEst++;return prev+cur.length+1},0);if(length>50){output=braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}else{output=braces[0]+base+" "+output.join(", ")+" "+braces[1]}return output}return format(obj,typeof depth==="undefined"?2:depth)}function isArray(ar){return Object.prototype.toString.call(ar)=="[object Array]"}function isRegExp(re){var s;try{s=""+re}catch(e){return false}return re instanceof RegExp||typeof re==="function"&&re.constructor.name==="RegExp"&&re.compile&&re.test&&re.exec&&s.match(/^\/.*\/[gim]{0,3}$/)}function isDate(d){if(d instanceof Date)return true;return false}function keys(obj){if(Object.keys){return Object.keys(obj)}var keys=[];for(var i in obj){if(Object.prototype.hasOwnProperty.call(obj,i)){keys.push(i)}}return keys}function map(arr,mapper,that){if(Array.prototype.map){return Array.prototype.map.call(arr,mapper,that)}var other=new Array(arr.length);for(var i=0,n=arr.length;i<n;i++)if(i in arr)other[i]=mapper.call(that,arr[i],i,arr);return other}function reduce(arr,fun){if(Array.prototype.reduce){return Array.prototype.reduce.apply(arr,Array.prototype.slice.call(arguments,1))}var len=+this.length;if(typeof fun!=="function")throw new TypeError;if(len===0&&arguments.length===1)throw new TypeError;var i=0;if(arguments.length>=2){var rv=arguments[1]}else{do{if(i in this){rv=this[i++];break}if(++i>=len)throw new TypeError}while(true)}for(;i<len;i++){if(i in this)rv=fun.call(null,rv,this[i],i,this)}return rv}expect.eql=function eql(actual,expected){if(actual===expected){return true}else if("undefined"!=typeof Buffer&&Buffer.isBuffer(actual)&&Buffer.isBuffer(expected)){if(actual.length!=expected.length)return false;for(var i=0;i<actual.length;i++){if(actual[i]!==expected[i])return false}return true}else if(actual instanceof Date&&expected instanceof Date){return actual.getTime()===expected.getTime()}else if(typeof actual!="object"&&typeof expected!="object"){return actual==expected}else{return objEquiv(actual,expected)}};function isUndefinedOrNull(value){return value===null||value===undefined}function isArguments(object){return Object.prototype.toString.call(object)=="[object Arguments]"}function objEquiv(a,b){if(isUndefinedOrNull(a)||isUndefinedOrNull(b))return false;if(a.prototype!==b.prototype)return false;if(isArguments(a)){if(!isArguments(b)){return false}a=pSlice.call(a);b=pSlice.call(b);return expect.eql(a,b)}try{var ka=keys(a),kb=keys(b),key,i}catch(e){return false}if(ka.length!=kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!=kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!expect.eql(a[key],b[key]))return false}return true}var json=function(){"use strict";if("object"==typeof JSON&&JSON.parse&&JSON.stringify){return{parse:nativeJSON.parse,stringify:nativeJSON.stringify}}var JSON={};function f(n){return n<10?"0"+n:n}function date(d,key){return isFinite(d.valueOf())?d.getUTCFullYear()+"-"+f(d.getUTCMonth()+1)+"-"+f(d.getUTCDate())+"T"+f(d.getUTCHours())+":"+f(d.getUTCMinutes())+":"+f(d.getUTCSeconds())+"Z":null}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value instanceof Date){value=date(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else if(typeof space==="string"){indent=space}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})};JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")};return JSON}();if("undefined"!=typeof window){window.expect=module.exports}})(this,"undefined"!=typeof module?module:{},"undefined"!=typeof exports?exports:{});(function(callback){if(typeof require==="function"&&typeof module==="object"){callback(require,exports,module)}else{window.puerh={};callback(undefined,puerh,{exports:puerh})}})(function(require,exports,module){var puerh=exports;puerh.use=function(module){switch(module){case"expect":if(require){return extendExpect(require("./vendor/expect"))}else{return extendExpect(expect)}break;default:break}};function extendExpect(expect){var Assertion=expect.Assertion,flags=expect.flags;flags.be.push("called");flags["called"]=["once","twice","thrice"];flags["always"]=["to"];flags.not.push("always");Assertion.prototype.spy=function(){var o=this.obj;assert.apply(this,[o&&o.getCall,"to be a spy"])};Assertion.prototype.called=function(){expect(this.obj).to.be.spy();assert.apply(this,[this.obj.called,"to be called"]);return this};Assertion.prototype.on=function(){expect(this.obj).to.be.spy();needCalledFlag(this);var a=Array.prototype.join.call(arguments,",");if(this.flags.always){assert.apply(this,[this.obj.alwaysCalledOn.apply(this.obj,arguments),'always to be called on "'+a+'"'])}else{assert.apply(this,[this.obj.calledOn.apply(this.obj,arguments),'to be called on "'+a+'"'])}};Assertion.prototype.match=function(){expect(this.obj).to.be.spy();needCalledFlag(this);var a=Array.prototype.join.call(arguments,",");if(this.flags.always){assert.apply(this,[this.obj.alwaysCalledWithMatch.apply(this.obj,arguments),'always to be called match "'+a+'"'])}else{assert.apply(this,[this.obj.calledWithMatch.apply(this.obj,arguments),'to be called match "'+a+'"'])}};Assertion.prototype.withArgs=function(){expect(this.obj).to.be.spy();needCalledFlag(this);var a=Array.prototype.join.call(arguments,",");var arr=["once","twice","thrice"];for(var i=0,l=arr.length;i<l;i++){if(this.flags[arr[i]]){var method="called"+capitalize(arr[i]);assert.apply(this,[this.obj.withArgs.apply(this.obj,arguments)[method],'to be called with "'+a+'" '+arr[i]]);return}}if(this.flags.always){assert.apply(this,[this.obj.alwaysCalledWith.apply(this.obj,arguments),'always to be called with "'+a+'"'])}else{assert.apply(this,[this.obj.calledWith.apply(this.obj,arguments),'to be called with "'+a+'"'])}};var arr=["once","twice","thrice"];for(var i=0,l=arr.length;i<l;i++){(function(times){Assertion.prototype[times]=function(){expect(this.obj).to.be.spy();needCalledFlag(this);assert.apply(this,[this.obj["called"+capitalize(times)],"to be called "+times])}})(arr[i])}Assertion.prototype.count=function(num){expect(this.obj).to.be.spy();needCalledFlag(this);assert.apply(this,[this.obj.callCount===num,"to be called "+num+' times"'])};Assertion.prototype.before=function(spy){expect(this.obj).to.be.spy();needCalledFlag(this);assert.apply(this,[this.obj.calledBefore.apply(this.obj,arguments),"to be called before "+spy])};Assertion.prototype.after=function(spy){expect(this.obj).to.be.spy();needCalledFlag(this);assert.apply(this,[this.obj.calledAfter.apply(this.obj,arguments),"to be called after "+spy])};Assertion.prototype.returned=function(value){expect(this.obj).to.be.spy();if(this.flags.always){assert.apply(this,[this.obj.alwaysReturned.apply(this.obj,arguments),"always to be returned "+value])}else{assert.apply(this,[this.obj.returned.apply(this.obj,arguments),"to be returned "+value])}};return expect}function needCalledFlag(assertion){if(!assertion.flags.called){throw new Error("Should be called first")}}function capitalize(str){return str.replace(/^[a-z]/,function(a){return a.toUpperCase()})}function assert(rule,msg){this.assert(rule,function(){return"expected "+this.obj+" "+msg},function(){return"expected "+this.obj+" not "+msg})}});